<!DOCTYPE html>
<html lang="en">

<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
	
	<!-- title -->
	
	<title>
	
		网络编程tcpip | 
	 
	hi
	</title>
	
	<!-- keywords,description -->
	
	

	<!-- favicon -->
	
	<link rel="shortcut icon" href="/favicon.ico">
	


	<!-- search -->
	<script>
		var searchEngine = "https://www.google.com/search?q=";
		if(typeof searchEngine == "undefined" || searchEngine == null || searchEngine == ""){
			searchEngine = "https://www.google.com/search?q=";
		}
		var homeHost = "";
		if(typeof homeHost == "undefined" || homeHost == null || homeHost == ""){
			homeHost = window.location.host;
		}
	</script>


	
<link rel="stylesheet" href="/css/main.css">

	
<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css">

	
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/styles/darcula.min.css">

	
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">


	
<script src="https://cdn.jsdelivr.net/npm/jquery@3.7.0/dist/jquery.min.js"></script>

	
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>

	
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/highlight.min.js"></script>

	
<script src="https://cdn.jsdelivr.net/npm/jquery-pjax@2.0.1/jquery.pjax.min.js"></script>

	
<script src="/js/main.js"></script>


	
		
<script src="https://cdn.jsdelivr.net/npm/leancloud-storage/dist/av-min.js"></script>

		
<script src="https://cdn.jsdelivr.net/npm/valine@v1.5.1/dist/Valine.min.js"></script>

	
	

<meta name="generator" content="Hexo 7.0.0"></head>

<body>
	<header id="header">
    <a id="title" href="/" class="logo">hi</a>

	<ul id="menu">
    

    

    

    
      
      
        <li class="menu-item">
          <a href='' class="menu-item-link" target="_blank">
            
          </a>
        </li>
      
    
  
    
      <li class="menu-item">
        <a href='https://github.com/wuliurong' class="menu-item-link" target="_blank">
          <i class="fa fa-github fa-2x"></i>
        </a>
      </li>
    
	</ul>
</header>

	
<div id="sidebar">
	<button id="sidebar-toggle" class="toggle" ><i class="fa fa-arrow-right " aria-hidden="true"></i></button>
	
	<div id="site-toc">
		<input id="search-input" class="search-input" type="search" placeholder="Press Enter to search">
		<div id="tree">
			

			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										Docker
									</a>
									
							<ul>
								<li class="file">
									<a href="/Docker/%E9%97%AE%E9%A2%98/">
                     
										    问题
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										Spark
									</a>
									
							<ul>
								<li class="file">
									<a href="/Spark/1-spark%E8%BD%AF%E4%BB%B6%E6%A0%88/">
                     
										    1-spark软件栈
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/Spark/centos%E6%90%AD%E5%BB%BApyspark%E7%8E%AF%E5%A2%83/">
                     
										    centos搭建pyspark环境
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/Spark/rdd%E4%BD%BF%E7%94%A8/">
                     
										    rdd使用
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/Spark/rdd%E7%AC%94%E8%AE%B0/">
                     
										    rdd笔记
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/Spark/windows%E6%90%AD%E5%BB%BApyspark%E7%8E%AF%E5%A2%83/">
                     
										    windows搭建pyspark环境
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										python
									</a>
									
							<ul>
								<li class="file">
									<a href="/python/lambda/">
                     
										    lambda
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/python/python/">
                     
										    python
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										tableau
									</a>
									
							<ul>
								<li class="file">
									<a href="/tableau/%E8%AF%BE%E4%BB%B6-tableau%E4%BB%AA%E8%A1%A8%E6%9D%BF/">
                     
										    课件-tableau仪表板
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/tableau/%E8%AF%BE%E4%BB%B6-tableau%E5%85%A5%E9%97%A8/">
                     
										    课件-tableau入门
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/tableau/%E8%AF%BE%E4%BB%B6-tableau%E7%BB%83%E4%B9%A0/">
                     
										    课件-tableau练习
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="file">
									<a href="/%E4%BD%9C%E4%B8%9A-pyechart/">
                     
										    作业-pyechart
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/%E4%BD%9C%E4%B8%9A-scrapy+mysql+kettle+flask+tableau+%E6%95%B0%E6%8D%AE%E6%8C%96%E6%8E%98+navicat/">
                     
										    作业-scrapy+mysql+kettle+flask+tableau+数据挖掘+navicat
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/%E4%BD%9C%E4%B8%9A-tableau/">
                     
										    作业-tableau
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										其他笔记
									</a>
									
							<ul>
								<li class="file">
									<a href="/%E5%85%B6%E4%BB%96%E7%AC%94%E8%AE%B0/vscode/">
                     
										    vscode
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file active">
									<a href="/%E5%85%B6%E4%BB%96%E7%AC%94%E8%AE%B0/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8Btcpip/">
                     
										    网络编程tcpip
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										报错
									</a>
									
							<ul>
								<li class="file">
									<a href="/%E6%8A%A5%E9%94%99/github%E5%9F%BA%E7%A1%80%E8%AF%AD%E5%8F%A5/">
                     
										    github基础语句
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/%E6%8A%A5%E9%94%99/hexo-deploy/">
                     
										    hexo-deploy
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/%E6%8A%A5%E9%94%99/hexo-typora-img/">
                     
										    hexo-typora-img
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/%E6%8A%A5%E9%94%99/vscode-install-config/">
                     
										    vscode-install-config
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										日记
									</a>
									
							<ul>
								<li class="file">
									<a href="/%E6%97%A5%E8%AE%B0/2024-1-13/">
                     
										    2024-1-13
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/%E6%97%A5%E8%AE%B0/2024-1-17/">
                     
										    2024-1-17
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/%E6%97%A5%E8%AE%B0/2024-1-19/">
                     
										    2024-1-19
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/%E6%97%A5%E8%AE%B0/2024-2-15/">
                     
										    2024-2-15
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										爬虫
									</a>
									
							<ul>
								<li class="file">
									<a href="/%E7%88%AC%E8%99%AB/1-%E5%9F%BA%E7%A1%80/">
                     
										    1-基础
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/%E7%88%AC%E8%99%AB/2-%E7%AC%94%E8%AE%B0/">
                     
										    2-笔记
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/%E7%88%AC%E8%99%AB/3-%E6%8A%A5%E9%94%99/">
                     
										    3-报错
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/%E7%88%AC%E8%99%AB/4.%E5%AE%9E%E8%B7%B5/">
                     
										    4.实践
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/%E7%88%AC%E8%99%AB/%E6%A8%A1%E6%8B%9F%E7%99%BB%E5%BD%95/">
                     
										    模拟登录
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/%E7%88%AC%E8%99%AB/%E7%88%AC%E5%8F%96%E5%8A%A8%E6%80%81%E9%A1%B5%E9%9D%A2/">
                     
										    爬取动态页面
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
		</div>
	</div>
</div>

	<!-- 引入正文 -->
	<div id="content" class="content">
		<h1 id="article-title">
	网络编程tcpip
</h1>

<!-- meta -->
<div class="article-meta">
	

	<span>lucky</span>
	<span>2024-06-14 13:49:19</span>

  <div id="article-categories">
    
		  <span>Categories：</span>
      
    

    
		    <span>Tags：</span>
        
    
  </div>

</div>

<!-- content -->
<div id="article-content">
	<h1 id="一：理解套接字"><a href="#一：理解套接字" class="headerlink" title="一：理解套接字"></a>一：理解套接字</h1><h3 id="server："><a href="#server：" class="headerlink" title="server："></a>server：</h3><p>1.调用socket函数创建套接字</p>
<p>2.调用bind函数分配IP地址和端口号</p>
<p>3.调用listen函数转为可接收请求状态</p>
<p>4.调用accept函数受理连接请求</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">socket</span><span class="params">(<span class="type">int</span> domain, <span class="type">int</span> type, <span class="type">int</span> protocal)</span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">成功返回文件描述符，失败返回-1</span></span><br><span class="line"><span class="comment">domain:套接字中使用的协议族信息</span></span><br><span class="line"><span class="comment">type:套接字数据传输类型信息</span></span><br><span class="line"><span class="comment">protocal:计算机通信中使用的协议信息</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">bind</span><span class="params">(<span class="type">int</span> sockdf, <span class="keyword">struct</span> sockaddr *myaddr, <span class="type">socklen_t</span> addrlen)</span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">sockfd:套接字文件描述符</span></span><br><span class="line"><span class="comment">myaddr:存有地址信息的结构体变量地址值</span></span><br><span class="line"><span class="comment">addlen：myaddr长度</span></span><br><span class="line"><span class="comment">bind(serv_sock,(struct sockaddr*) &amp;serv_addr, sizeof(serv_addr))</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">listen</span><span class="params">(<span class="type">int</span> sock, <span class="type">int</span> backlog)</span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">sock:套接字文件符</span></span><br><span class="line"><span class="comment">backlog:连接请求等待队列的长度，5，表示最多使5个连接请求进入队列</span></span><br><span class="line"><span class="comment">（只有服务端调用了listen，客户端才能调用connect）</span></span><br><span class="line"><span class="comment">（频繁请求的web服务器端至少为15，具体视实际情况定）</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">accept</span><span class="params">(<span class="type">int</span> sock, <span class="keyword">struct</span> sockaddr * addr, <span class="type">socklen_t</span> * addrlen)</span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">addr：发起请求的客户端地址值</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h3 id="client："><a href="#client：" class="headerlink" title="client："></a>client：</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">connect(<span class="type">int</span> sockfd, <span class="keyword">struct</span> sockaddr *serv_addr, <span class="type">socklen_t</span> addrlen);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">向服务器端发送连接请求</span></span><br><span class="line"><span class="comment">sock:客户端套接字描述符</span></span><br><span class="line"><span class="comment">serv_addr:目标服务器地址信息的变量地址值</span></span><br><span class="line"><span class="comment">addrlen:地址变量长度</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//客户端的IP地址和端口号在调用connect函数时自动分配，无需调用标记的bind函数进行分配</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//终端 编译+运行</span></span><br><span class="line">gcc hello_server.c -o hserver</span><br><span class="line">./hserver <span class="number">9190</span></span><br><span class="line">    </span><br><span class="line">gcc hello_client.c -o hclient</span><br><span class="line">./hclient <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="number">9190</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">//本机同时为服务和客户，使用本地环回127.0.0.1</span></span><br></pre></td></tr></table></figure>



<h3 id="文件操作"><a href="#文件操作" class="headerlink" title="文件操作"></a>文件操作</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">open</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *path, <span class="type">int</span> flag)</span>;<span class="comment">//打开文件</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">path：文件字符串地址</span></span><br><span class="line"><span class="comment">flag：模式信息 </span></span><br><span class="line"><span class="comment">	O_CREAT		创建</span></span><br><span class="line"><span class="comment">	O_TRUNC		删除现有全部</span></span><br><span class="line"><span class="comment">	O_APPEND	维持现有全部，保存到后面</span></span><br><span class="line"><span class="comment">	O_RDONLY	只读</span></span><br><span class="line"><span class="comment">	O_WRONLY	只写</span></span><br><span class="line"><span class="comment">	O_RDWR		读写打开</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">close</span><span class="params">(<span class="type">int</span> fd)</span><span class="comment">//关闭文件</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">fd:文件or套接字文件描述符,从3开始</span></span><br><span class="line"><span class="comment">I/O标准文件描述符</span></span><br><span class="line"><span class="comment">0：标准输入</span></span><br><span class="line"><span class="comment">1：标准输出</span></span><br><span class="line"><span class="comment">2：标准错误</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">    </span><br><span class="line"><span class="type">ssize_t</span> <span class="title function_">write</span><span class="params">(<span class="type">int</span> fd, <span class="type">const</span> <span class="type">void</span> * buf, <span class="type">size_t</span> nbytes)</span>;<span class="comment">//写入</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">成功返回字节数，失败-1</span></span><br><span class="line"><span class="comment">fd：文件描述符</span></span><br><span class="line"><span class="comment">buf：保存要传输数据的缓冲地址</span></span><br><span class="line"><span class="comment">nbytes：要传输数据的字节数</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="type">ssize_t</span> <span class="title function_">read</span><span class="params">(<span class="type">int</span> fd, <span class="type">void</span> * buf, <span class="type">size_t</span> nbytes)</span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">成功返回字节数，失败-1</span></span><br><span class="line"><span class="comment">fd：文件描述符</span></span><br><span class="line"><span class="comment">buf：保存要接收数据的缓冲地址</span></span><br><span class="line"><span class="comment">nbytes：接受数据的最大字节数</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>



<h3 id="元数据类型primitive"><a href="#元数据类型primitive" class="headerlink" title="元数据类型primitive"></a>元数据类型primitive</h3><p>#include&lt;sys&#x2F;types.h&gt;头文件中由typedef声明</p>
<p>typedef  unsigned int <strong>size_t</strong></p>
<p>typedef signed int <strong>ssize_t</strong></p>
<p>操作系统定义的数据类型会添加后缀_t</p>
<h1 id="二：套接字类型与协议设置"><a href="#二：套接字类型与协议设置" class="headerlink" title="二：套接字类型与协议设置"></a>二：套接字类型与协议设置</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="comment">//文件头声名的协议族</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">PF_INET		ipv4</span></span><br><span class="line"><span class="comment">PF_INET6	ipv6</span></span><br><span class="line"><span class="comment">PF_LOCAL	本地通信的UNIX协议族</span></span><br><span class="line"><span class="comment">PF_PACKET	底层套接字的协议族</span></span><br><span class="line"><span class="comment">PF_IPX		IPX Novell协议族</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">socket</span><span class="params">(<span class="type">int</span> domain, <span class="type">int</span> type, <span class="type">int</span> protocal)</span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">domain:套接字中使用的协议族信息</span></span><br><span class="line"><span class="comment">type:套接字数据传输类型信息</span></span><br><span class="line"><span class="comment">protocal:计算机通信中使用的协议信息</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> tcp_socket = socket(PF_INET, SOCK_STREAM, IPPROTO_TCP);<span class="comment">//面向连接</span></span><br><span class="line"><span class="type">int</span> udp_socket = socket(PF_INET, SOCK_DGRAM, IPPROTO_UDP);<span class="comment">//面向消息</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">tcp:不丢失，不失序，无数据边界（都到达后发送）       （发nv1收）</span></span><br><span class="line"><span class="comment">udp：快速，失序丢失，数据边界，限制每次传输数据大小   （发1v1收）</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h1 id="三：地址族与数据序列"><a href="#三：地址族与数据序列" class="headerlink" title="三：地址族与数据序列"></a>三：地址族与数据序列</h1><img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701589348013.png" alt="1701589348013" style="zoom: 67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701589370631.png" alt="1701589370631" style="zoom:67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701589595127.png" alt="1701589595127" style="zoom: 67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701589617694.png" alt="1701589617694" style="zoom:50%;">

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sockaddr</span>&#123;</span></span><br><span class="line">    <span class="type">sa_family_t</span> sin_family; <span class="comment">//地址族</span></span><br><span class="line">    <span class="type">char</span> sa_data[<span class="number">14</span>];		<span class="comment">//地址信息</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701590199637.png" alt="1701590199637" style="zoom:67%;">

<h3 id="字节序"><a href="#字节序" class="headerlink" title="字节序"></a>字节序</h3><p>大端序：0x1234  0x12 0x34</p>
<p>小端序：0x1234  0x34 0x12</p>
<p>网络字节序统一为大端序，不同cpu不同端序（intel与AMD cpu小端序）</p>
<p>htons()：主机字节序转为网络字节序</p>
<p>htonl()：网络字节序转为主机字节序</p>
<p>IP地址不需要考虑字节序问题，端口号需要</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="comment">//十进制转为32位大端序整型</span></span><br><span class="line"><span class="type">in_addr_t</span> <span class="title function_">inet_addr</span><span class="params">(<span class="type">const</span> <span class="type">char</span> * <span class="built_in">string</span>)</span>;</span><br><span class="line"><span class="comment">//成功返回32位整型，失败返回INADDR_NONE  %#lx</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">inet_aton</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *<span class="built_in">string</span>, <span class="keyword">struct</span> in_addr * addr)</span>;</span><br><span class="line"><span class="comment">//成功返回true，失败false，将string转的32位整型存入in_addr结构体变量地址addr</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//32位整型转为十进制</span></span><br><span class="line"><span class="type">char</span> * <span class="title function_">inet_ntoa</span><span class="params">(<span class="keyword">struct</span> in_addr adr)</span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">1.网络字节序转为主机字节序</span></span><br><span class="line"><span class="comment">2.成功返回字符串地址 char *str_ptr，失败返回-1</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701597833345.png" alt="1701597833345" style="zoom:80%;">

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> *<span class="title function_">memset</span><span class="params">(<span class="type">void</span> *ptr, <span class="type">int</span> value, <span class="type">size_t</span> num)</span>;<span class="comment">//将内存指定区域初始化</span></span><br></pre></td></tr></table></figure>

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701598638144.png" alt="1701598638144" style="zoom: 80%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701598657479.png" alt="1701598657479">



<h1 id="四：基于TCP的服务端-客户端（1）"><a href="#四：基于TCP的服务端-客户端（1）" class="headerlink" title="四：基于TCP的服务端&#x2F;客户端（1）"></a>四：基于TCP的服务端&#x2F;客户端（1）</h1><img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701600535683.png" alt="1701600535683" style="zoom:80%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701603643217.png" alt="1701603643217" style="zoom:67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701603627056.png" alt="1701603627056" style="zoom:67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701604531807.png" alt="1701604531807" style="zoom:67%;">



<p> 客户端调用connect前,服务端有可能会提前调用accept函数并进入阻塞状态(blocking)</p>
<p>原因：</p>
<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701604725727.png" alt="1701604725727" style="zoom:80%;">

<h1 id="五：基于TCP的服务端-客户端（2）"><a href="#五：基于TCP的服务端-客户端（2）" class="headerlink" title="五：基于TCP的服务端&#x2F;客户端（2）"></a>五：基于TCP的服务端&#x2F;客户端（2）</h1><p><strong>回声echo</strong></p>
<p>客户端：write-read</p>
<p>服务端：read-write</p>
<p><strong>TCP套接字缓冲</strong></p>
<p>write时，数据在发送方输出缓冲区，在接收方同意接收数据时，数据在接收方的输入缓冲区，read读取输入缓冲区数据，通过滑动窗口协议控制</p>
<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701655709768.png" alt="1701655709768" style="zoom:67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701655723924.png" alt="1701655723924" style="zoom:67%;">

<ul>
<li><input checked disabled type="checkbox"> ACK  &#x3D;  SEQ  + 传递字节数 +1</li>
</ul>
<p>SEQ顺序标识符是给信息编号。ACK是用于回复带有编号的信息。也就是说，每次传输信息时，都同时发送SEQ标识，而受到信息的主机应以SEQ信息为基础回复发送信息的主机。通过这种机制，传输数据的主机就可以确认数据是否被正确接收。在传输失败时，可以重新传送。 </p>
<h1 id="六：实现基于UDP的服务端和客户端"><a href="#六：实现基于UDP的服务端和客户端" class="headerlink" title="六：实现基于UDP的服务端和客户端"></a>六：实现基于UDP的服务端和客户端</h1><p>UDP不存在请求连接过程，在某种意义上无法明确区分服务器端和客户端</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//UDP传输数据</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="type">ssize_t</span> <span class="title function_">sendto</span><span class="params">(<span class="type">int</span> sock, <span class="type">void</span> *buff, <span class="type">size_t</span> nbytes, <span class="type">int</span> flags,</span></span><br><span class="line"><span class="params">               <span class="keyword">struct</span> sockaddr *to, <span class="type">socklen_t</span> addrlen)</span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">buff:		保存待传输数据的缓冲地址值</span></span><br><span class="line"><span class="comment">nbytes:		待传输数据长度，字节单位</span></span><br><span class="line"><span class="comment">flags:		可选项参数，没有为0</span></span><br><span class="line"><span class="comment">to:			存有目标地址信息的sockaddr结构体变量的地址值	</span></span><br><span class="line"><span class="comment">addrlen:	传递给to的地址值结构体变量长度</span></span><br><span class="line"><span class="comment">返回字节数或-1</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//UDP接收数据</span></span><br><span class="line"><span class="type">ssize_t</span> <span class="title function_">recvfrom</span><span class="params">(<span class="type">int</span> sock, <span class="type">void</span> *buff, <span class="type">size_t</span> nbytes, <span class="type">int</span> flags,</span></span><br><span class="line"><span class="params">                <span class="keyword">struct</span> sockaddr *from, <span class="type">socklen_t</span> *addrlen)</span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">buff:		保存接收数据的缓冲地址值</span></span><br><span class="line"><span class="comment">nbytes:		可接收最大字节数，不能超过buff所指的缓冲大小</span></span><br><span class="line"><span class="comment">flags:		可选项参数，没有为0</span></span><br><span class="line"><span class="comment">to:			存有发送端地址信息的sockaddr结构体变量的地址值	</span></span><br><span class="line"><span class="comment">addrlen:	传递给to的地址值结构体变量长度的变量地址值</span></span><br><span class="line"><span class="comment">返回字节数或-1</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">recvfrom(serv_sock, message, BUF_SIZE, <span class="number">0</span>,(<span class="keyword">struct</span> sockaddr*)&amp;clnt_addr, &amp;clnt_addr_size);</span><br><span class="line">sendto(serv_sock, message, str_len, <span class="number">0</span>,(<span class="keyword">struct</span> sockaddr*)&amp;clnt_addr, clnt_addr_size);</span><br></pre></td></tr></table></figure>



<p><strong>UDP套接字地址分配：</strong>首次调用sendto函数时候自动分配IP和端口，此时的分配地址保留到程序结束为止</p>
<p><strong>UDP数据边界：</strong>输入输出调用次数相同</p>
<p><strong>sendto传输数据阶段：</strong></p>
<p>​			1.向UDP套接字注册目标IP和端口号</p>
<p>​			2.传输数据</p>
<p>​			3.删除UDP套接字中注册的目标信息</p>
<p>1和3阶段占用1&#x2F;3时间</p>
<p>优化：调用connect向UDP套接字注册目标IP和端口信息指定收发对象，每次调用sendto时只需传输数据，此时可使用write和read替代sendto和recvfrom</p>
<h1 id="七：套接字半连接"><a href="#七：套接字半连接" class="headerlink" title="七：套接字半连接"></a>七：套接字半连接</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">shutdown</span><span class="params">(<span class="type">int</span> sock, <span class="type">int</span> howto)</span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">howto:传递断开方式</span></span><br><span class="line"><span class="comment">SHUT_RD:断开输入，输入缓冲抹去</span></span><br><span class="line"><span class="comment">SHUT_WR:断开输出，输出缓冲缓冲至目标主机</span></span><br><span class="line"><span class="comment">SHUT_RDWR:IO都断开</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701680846858.png" alt="1701680846858" style="zoom:67%;">

<h1 id="八：域名及网络地址"><a href="#八：域名及网络地址" class="headerlink" title="八：域名及网络地址"></a>八：域名及网络地址</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//通过域名获取IP地址</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;netdb.h&gt;</span></span></span><br><span class="line"><span class="keyword">struct</span> hostent * <span class="title function_">gethostbyname</span><span class="params">(<span class="type">const</span> <span class="type">char</span> * hostname)</span>;</span><br><span class="line"><span class="comment">//成功返回hostent结构体地址，失败返回空指针</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//通过IP地址获取域名</span></span><br><span class="line"><span class="keyword">struct</span> hostent * <span class="title function_">gethostbyaddr</span><span class="params">(<span class="type">const</span> <span class="type">char</span> * addr, <span class="type">socklen_t</span> len, <span class="type">int</span> family)</span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">//成功返回hostent结构体地址，失败返回空指针</span></span><br><span class="line"><span class="comment">addr:含有IP地址信息的in_addr结构体指针，为同时传递IPV4之外信息，声名为char</span></span><br><span class="line"><span class="comment">len:向第一个参数传递的地址信息的字节数，IPV4为4， IPV6为16</span></span><br><span class="line"><span class="comment">family:地址族信息</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701694490624.png" alt="1701694490624" style="zoom:67%;">

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">h_name:			官方域名</span></span><br><span class="line"><span class="comment">h_aliases:		同一IP绑定多个域名</span></span><br><span class="line"><span class="comment">h_addrtype:		获取h_addr_list的IP地址族信息，ipv4为AF_INET</span></span><br><span class="line"><span class="comment">h_length:		IP地址长度</span></span><br><span class="line"><span class="comment">h_addr_list:	网站用户多，同一域名多个IP，利用多个服务器负载均衡</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701697873091.png" alt="1701697873091" style="zoom:67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701697889536.png" alt="1701697889536" style="zoom:67%;">

<p><img src="/.io//hexo\blog\source\source\images\网络编程tcpip\1701700065666.png" alt="1701700065666"></p>
<h1 id="九：套接字的多种可选项"><a href="#九：套接字的多种可选项" class="headerlink" title="九：套接字的多种可选项"></a>九：套接字的多种可选项</h1><p><img src="/.io//hexo\blog\source\source\images\网络编程tcpip\1701701768820.png"></p>
<p><img src="/.io//hexo\blog\source\source\images\网络编程tcpip\1701701914271.png" alt="1701701914271"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">SOL_SOCKET:用于操作与套接字本身相关的选项</span></span><br><span class="line"><span class="comment">IPPROTO_IP:用于操作与 IP 协议相关的选项</span></span><br><span class="line"><span class="comment">IPPROTO_TCP:用于操作与 TCP 协议相关的选项</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">SO_REUSEADDR:允许多个套接字绑定到相同的地址和端口，通常用于服务器程序。0允许，1允许</span></span><br><span class="line"><span class="comment">SO_KEEPALIVE:启用或禁用保持活动连接的机制，用于检测连接是否仍然有效。</span></span><br><span class="line"><span class="comment">SO_RCVBUF 和 SO_SNDBUF：设置接收缓冲区和发送缓冲区的大小。</span></span><br><span class="line"><span class="comment">SO_LINGER：设置关闭套接字时的行为，可以控制套接字在关闭时的等待时间。</span></span><br><span class="line"><span class="comment">SO_ERROR：获取套接字的错误状态。</span></span><br><span class="line"><span class="comment">IP_TTL（设置生存时间）</span></span><br><span class="line"><span class="comment">IP_TOS（设置服务类型）</span></span><br><span class="line"><span class="comment">IP_MULTICAST_TTL（设置多播生存时间）</span></span><br><span class="line"><span class="comment">TCP_NODELAY（禁用 Nagle 算法），0允许，1禁用</span></span><br><span class="line"><span class="comment">TCP_KEEPIDLE（设置空闲连接的时间）</span></span><br><span class="line"><span class="comment">TCP_MAXSEG（设置最大段大小）</span></span><br><span class="line"><span class="comment">*/</span>    </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>nagle算法： 主要思想是将多个小的数据块缓冲在一起，然后一起发送，而不是每个小数据块都单独发送。这样做的好处是减少了网络中的小数据包数量，从而减小了网络传输的开销和延迟。在某些情况下，特别是在高延迟的网络连接上，Nagle算法可以显著提高性能。 </p>
<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701764149000.png" alt="1701764149000" style="zoom: 80%;">



<p>读取套接字可选项<img src="/.io//hexo\blog\source\source\images\网络编程tcpip\1701701955913.png" alt="1701701955913"></p>
<p>更改</p>
<p><img src="/.io//hexo\blog\source\source\images\网络编程tcpip\1701702081392.png" alt="1701702081392"></p>
<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701702089504.png" alt="1701702089504" style="zoom:80%;">

<h3 id="Time-wait状态"><a href="#Time-wait状态" class="headerlink" title="Time-wait状态"></a>Time-wait状态</h3><p>客户端关闭，发送FIN到服务器，断开连接</p>
<p>服务器强制关闭，发送FIN到客户端，同一端口号运行bind()error，三分钟后可运行</p>
<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701761217500.png" alt="1701761217500" style="zoom: 50%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701761637299.png" alt="1701761637299" style="zoom:67%;">

<p>先传输FIN消息的主机应该经过time-wait过程，原因：使最后ACK丢失时，对方能够重传FIN</p>
<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701761861357.png" alt="1701761861357" style="zoom: 50%;">

<h1 id="十：多进程服务器端"><a href="#十：多进程服务器端" class="headerlink" title="十：多进程服务器端"></a>十：多进程服务器端</h1><p><img src="/.io//hexo\blog\source\source\images\网络编程tcpip\1701764475739.png" alt="1701764475739"></p>
<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701768803341.png" alt="1701768803341" style="zoom: 67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701768832629.png" alt="1701768832629" style="zoom:80%;">



<p><strong>僵尸进程</strong>：父进程主动发起请求（函数调用）时，操作系用才会传递exit参数值或return语句返回值</p>
<p><strong>后台处理</strong>：<code>./exefilename &amp;  </code>    程序在后台运行，不阻塞终端</p>
<p><strong>查看进程</strong>：<code>ps au</code></p>
<h3 id="销毁僵尸进程"><a href="#销毁僵尸进程" class="headerlink" title="销毁僵尸进程"></a>销毁僵尸进程</h3><img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701776306348.png" alt="1701776306348" style="zoom: 67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701776344943.png" alt="1701776344943" style="zoom:67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701776397578.png" alt="1701776397578" style="zoom:67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701776641827.png" alt="1701776641827" style="zoom:67%;">

<h3 id="信号注册函数"><a href="#信号注册函数" class="headerlink" title="信号注册函数"></a>信号注册函数</h3><h3 id="signal"><a href="#signal" class="headerlink" title="signal()"></a>signal()</h3><img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701777495428.png" alt="1701777495428" style="zoom: 80%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701778604910.png" alt="1701778604910" style="zoom: 80%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701779099040.png" alt="1701779099040" style="zoom:67%;">

<p>signal.c   发生信号时将唤醒由于调用sleep函数而进入阻塞状态的进程</p>
<h3 id="sigaction-取代signal"><a href="#sigaction-取代signal" class="headerlink" title="sigaction():  取代signal()"></a>sigaction():  取代signal()</h3><img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701779207839.png" alt="1701779207839" style="zoom:67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701779244820.png" alt="1701779244820" style="zoom: 67%;">

<p>sa_handler保存信号处理函数的指针值（地址值），sa_mask,sa_flags用于指定信号的相关的选项和特性，暂时初始化为0</p>
<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701779522026.png" alt="1701779522026" style="zoom:67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701779594281.png" alt="1701779594281" style="zoom:67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701779617792.png" alt="1701779617792" style="zoom: 67%;">

<h3 id="基于多任务的并发服务器"><a href="#基于多任务的并发服务器" class="headerlink" title="基于多任务的并发服务器"></a>基于多任务的并发服务器</h3><img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701787033009.png" alt="1701787033009" style="zoom:67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701787128900.png" alt="1701787128900" style="zoom:67%;">

<h3 id="关闭多余套接字连接"><a href="#关闭多余套接字连接" class="headerlink" title="关闭多余套接字连接"></a>关闭多余套接字连接</h3><p>fork复制父进程所有资源，父进程和子进程两个文件描述符都指向同一套接字，需要关闭多余的描述符</p>
<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701857194338.png" alt="1701857194338" style="zoom: 67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701857368033.png" alt="1701857368033" style="zoom:67%;">

<h3 id="回声客户端IO分割："><a href="#回声客户端IO分割：" class="headerlink" title="回声客户端IO分割："></a>回声客户端IO分割：</h3><p>echo_mpclient.c</p>
<p>子进程输出数据</p>
<p>父进程接收回声数据</p>
<p>共用同一个socket</p>
<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701862902771.png" alt="1701862902771" style="zoom:67%;">



<h1 id="十一：进程间的通信IPC"><a href="#十一：进程间的通信IPC" class="headerlink" title="十一：进程间的通信IPC"></a>十一：进程间的通信IPC</h1><h3 id="管道PIPE实现进程通信"><a href="#管道PIPE实现进程通信" class="headerlink" title="管道PIPE实现进程通信"></a>管道PIPE实现进程通信</h3><h4 id="单向"><a href="#单向" class="headerlink" title="单向"></a>单向</h4><img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701863473496.png" alt="1701863473496" style="zoom: 50%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701863617409.png" alt="1701863617409" style="zoom:67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701864878050.png" alt="1701864878050" style="zoom:67%;">

<p>buf[2]存的是指向管道内存空间的指针，子进程写入将str数据复制到管道内存中，父进程读出将管道数据复制到buf中，不共用同一指针的原因：避免多个进程争夺该指针的访问权限 </p>
<h4 id="双向"><a href="#双向" class="headerlink" title="双向"></a>双向</h4><img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701865100398.png" alt="1701865100398" style="zoom:50%;">

<p>管道数据先进先出，子进程发送数据，子进程读数据快于父进程，此时管道空，父进程读数据将陷入无限的等待。</p>
<p>解决：两个管道</p>
<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701866765258.png" alt="1701866765258" style="zoom:50%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701867710986.png" alt="1701867710986" style="zoom:67%;">

<p>服务器多进程通信（子进程1将数据保存到文件中，子进程2将数据回声到客户端和将数据复制到管道内）</p>
<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701867827679.png" alt="1701867827679" style="zoom: 67%;">

<p>进程间通信： IPC允许不同的进程之间进行数据传输、共享内存、发送信号等操作，以便它们能够相互通信和协作 ， 从内存角度来看，不同进程拥有独立的内存空间，它们的数据不会直接共享。在IPC中，数据的共享通常通过内核提供的特殊机制来实现，例如共享内存区域或消息队列。 </p>
<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701868095657.png" alt="1701868095657" style="zoom: 80%;">

<h1 id="十二：I-O复用"><a href="#十二：I-O复用" class="headerlink" title="十二：I&#x2F;O复用"></a>十二：I&#x2F;O复用</h1><img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701932925020.png" alt="1701932925020" style="zoom:80%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701930173517.png" alt="1701930173517" style="zoom: 67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701874269029.png" alt="1701874269029" style="zoom:67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701874354480.png" alt="1701874354480" style="zoom:67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701874550842.png" alt="1701874550842" style="zoom:67%;">

<h3 id="select（）："><a href="#select（）：" class="headerlink" title="select（）："></a>select（）：</h3><p> <code>select</code> 函数是用于实现多路复用的系统调用，它允许一个进程监视多个文件描述符，以确定哪些文件描述符已经准备好读取、写入或已经发生异常等事件。<code>select</code> 函数通常用于实现异步 I&#x2F;O 操作，特别是在处理多个套接字或文件描述符的情况下非常有用。 </p>
<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701874592626.png" alt="1701874592626" style="zoom:67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701874629501.png" alt="1701874629501" style="zoom: 67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701875151571.png" alt="1701875151571" style="zoom: 80%;">

<p><img src="/.io//hexo\blog\source\source\images\网络编程tcpip\1701875176811.png" alt="1701875176811"></p>
<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701875213770.png" alt="1701875213770" style="zoom:80%;">

<h3 id="select-代码示例"><a href="#select-代码示例" class="headerlink" title="select()代码示例"></a>select()代码示例</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;sys/time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;sys/select.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BUF_SIZE 30</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span>&#123;<span class="comment">//       </span></span><br><span class="line">    fd_set reads, temps;</span><br><span class="line">    <span class="type">int</span> result , str_len;</span><br><span class="line">    <span class="type">char</span> buf[BUF_SIZE];</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">timeval</span> <span class="title">timeout</span>;</span></span><br><span class="line">    FD_ZERO(&amp;reads);</span><br><span class="line">    FD_SET(<span class="number">0</span>,&amp;reads);<span class="comment">//标准输入文件描述符的值通常是 0，标准输出是 1，标准错误是 2。</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    timeout.tv_sec=5;</span></span><br><span class="line"><span class="comment">    timeout.tv_usec=5000;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">   &#123;</span><br><span class="line">    temps=reads;<span class="comment">//调用select函数后，除了发生变化的文件描述符其他位初始化为0，为保存初始值</span></span><br><span class="line">    timeout.tv_sec=<span class="number">5</span>;<span class="comment">//select调用后，结构体timeval和tv_sec和tv_usec值被替换为超时前剩余时间</span></span><br><span class="line">    timeout.tv_usec=<span class="number">0</span>;<span class="comment">//因此在每次调用select前都需要初始化timeval结构体变量</span></span><br><span class="line">    result=select(<span class="number">1</span>,&amp;temps,<span class="number">0</span>,<span class="number">0</span>,&amp;timeout);</span><br><span class="line">    <span class="keyword">if</span>(result==<span class="number">-1</span>)&#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;select()error&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(result==<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;time out!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(FD_ISSET(<span class="number">0</span>,&amp;temps))&#123;</span><br><span class="line">            str_len=read(<span class="number">0</span>,buf,BUF_SIZE);<span class="comment">//控制台数据在缓冲区，调用read将缓冲区数据读入buf中</span></span><br><span class="line">            buf[str_len]=<span class="number">0</span>;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;message from console %s&quot;</span>,buf);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="IO复用，echo-selectserv-c"><a href="#IO复用，echo-selectserv-c" class="headerlink" title="IO复用，echo_selectserv.c"></a>IO复用，echo_selectserv.c</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#include&lt;stdlib.h&gt;</span><br><span class="line">#include&lt;string.h&gt;</span><br><span class="line">#include&lt;unistd.h&gt;</span><br><span class="line">#include&lt;arpa/inet.h&gt;</span><br><span class="line">#include&lt;sys/socket.h&gt;</span><br><span class="line">#include&lt;sys/time.h&gt;</span><br><span class="line">#include&lt;sys/select.h&gt;</span><br><span class="line"></span><br><span class="line">#define BUF_SIZE 100</span><br><span class="line">void error_handling(char *buf);</span><br><span class="line"></span><br><span class="line">int main(int argc, char *argv[])</span><br><span class="line">&#123;</span><br><span class="line">    int serv_sock,clnt_sock;</span><br><span class="line">    struct sockaddr_in serv_addr,clnt_addr;</span><br><span class="line">    struct timeval timeout;</span><br><span class="line">    fd_set reads, cpy_reads;</span><br><span class="line"></span><br><span class="line">    socklen_t adr_sz;</span><br><span class="line">    int fd_max,str_len,fd_num,i;</span><br><span class="line">    char buf[BUF_SIZE];</span><br><span class="line">    if(argc!=2)&#123;</span><br><span class="line">        printf(&quot;Usage : %s &lt;port&gt;\n&quot;, argv[0]);</span><br><span class="line">        exit(1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    serv_sock = socket(PF_INET,SOCK_STREAM, 0);</span><br><span class="line">    memset(&amp;serv_addr, 0, sizeof(serv_addr));</span><br><span class="line">    serv_addr.sin_family=AF_INET;</span><br><span class="line">    serv_addr.sin_addr.s_addr=htonl(INADDR_ANY);</span><br><span class="line">    serv_addr.sin_port=htons(atoi(argv[1]));</span><br><span class="line"></span><br><span class="line">    if(bind(serv_sock,(struct sockaddr*) &amp;serv_addr, sizeof(serv_addr))==-1)</span><br><span class="line">        error_handling(&quot;bind()error&quot;);</span><br><span class="line">    if(listen(serv_sock,5)==-1)</span><br><span class="line">        error_handling(&quot;listen()error&quot;);</span><br><span class="line"></span><br><span class="line">    FD_ZERO(&amp;reads);</span><br><span class="line">    FD_SET(serv_sock, &amp;reads);</span><br><span class="line">    fd_max=serv_sock;</span><br><span class="line">    while(1)</span><br><span class="line">    &#123;</span><br><span class="line">        cpy_reads=reads;</span><br><span class="line">        timeout.tv_sec=5;</span><br><span class="line">        timeout.tv_usec=5000;</span><br><span class="line"></span><br><span class="line">        if((fd_num=select(fd_max+1, &amp;cpy_reads, 0, 0, &amp;timeout))==-1)</span><br><span class="line">            break;</span><br><span class="line">        if(fd_num==0)</span><br><span class="line">            continue;</span><br><span class="line"></span><br><span class="line">        for(i=0; i&lt;fd_max+1; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            if(FD_ISSET(i, &amp;cpy_reads))//检查当前循环迭代的文件描述符是否准备好接收数据。</span><br><span class="line">            &#123;</span><br><span class="line">                if(i==serv_sock)//当 i 等于 serv_sock 时，表示有新的客户端请求连接到服务器。 accept 操作来接受新的连接，并将新连接的套接字添加到 reads 集合中</span><br><span class="line">                &#123;</span><br><span class="line">                    adr_sz=sizeof(clnt_addr);</span><br><span class="line">                    clnt_sock=accept(serv_sock,(struct sockaddr*)&amp;clnt_addr, &amp;adr_sz);</span><br><span class="line">                    FD_SET(clnt_sock, &amp;reads);</span><br><span class="line">                    if(fd_max&lt;&lt;clnt_sock)</span><br><span class="line">                        fd_max=clnt_sock;//更新最大文件描述符</span><br><span class="line">                    printf(&quot;connected client: %d \n&quot;, clnt_sock);</span><br><span class="line">                &#125;</span><br><span class="line">                else</span><br><span class="line">                &#123;</span><br><span class="line">                    str_len=read(i, buf, BUF_SIZE);</span><br><span class="line">                    if(str_len==0)</span><br><span class="line">                    &#123;</span><br><span class="line">                        FD_CLR(i, &amp;reads);//表示将文件描述符 i 从 reads 集合中清除，即将reads中对应文件描述符位置值从1变为0，表示不再监控该文件描述符</span><br><span class="line">                        close(i);</span><br><span class="line">                        printf(&quot;closed client: %d \n&quot;, i);</span><br><span class="line">                    &#125;</span><br><span class="line">                    else</span><br><span class="line">                    &#123;</span><br><span class="line">                        write(i,buf, str_len);//回声</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    close(serv_sock);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void error_handling(char *buf)&#123;</span><br><span class="line">    fputs(buf, stderr);</span><br><span class="line">    fputc(&#x27;\n&#x27;,stderr);</span><br><span class="line">    exit(1);</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701929844022.png" alt="1701929844022" style="zoom: 80%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701932872135.png" alt="1701932872135" style="zoom: 80%;">

<h1 id="十三：多种IO函数"><a href="#十三：多种IO函数" class="headerlink" title="十三：多种IO函数"></a>十三：多种IO函数</h1><h3 id="linux：send-recv"><a href="#linux：send-recv" class="headerlink" title="linux：send&amp;recv"></a>linux：send&amp;recv</h3><img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701933898336.png" alt="1701933898336" style="zoom:67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701933915609.png" alt="1701933915609" style="zoom:67%;">

<h4 id="send-recv可选项"><a href="#send-recv可选项" class="headerlink" title="send&amp;recv可选项"></a>send&amp;recv可选项</h4><img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701933938278.png" alt="1701933938278" style="zoom:67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702028585526.png" alt="1702028585526" style="zoom:67%;">

<h4 id="外带数据"><a href="#外带数据" class="headerlink" title="外带数据"></a>外带数据</h4><p> 带外数据（Out-of-Band Data，简称OOB数据）是在计算机网络通信中的一个概念，它指的是与正常数据流分离的一种特殊数据传输方式。带外数据通常用于传输一些具有高优先级或紧急性的信息，这些信息需要立即处理，而不受正常数据流的顺序限制。 </p>
<h4 id="传输外带数据"><a href="#传输外带数据" class="headerlink" title="传输外带数据"></a>传输外带数据</h4><img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701938835593.png" alt="1701938835593" style="zoom: 80%;">



<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701938813535.png" alt="1701938813535" style="zoom: 80%;">

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;netinet/in.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;signal.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BUF_SIZE 30</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">error_handling</span><span class="params">(<span class="type">char</span> *message)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">urg_handler</span><span class="params">(<span class="type">int</span> signo)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> acpt_sock;</span><br><span class="line"><span class="type">int</span> recv_sock;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">recv_adr</span>,<span class="title">serv_adr</span>;</span></span><br><span class="line">    <span class="type">int</span> str_len, state;</span><br><span class="line">    <span class="type">socklen_t</span> serv_adr_sz;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">sigaction</span> <span class="title">act</span>;</span></span><br><span class="line">    <span class="type">char</span> buf[BUF_SIZE];</span><br><span class="line">    <span class="keyword">if</span>(argc!=<span class="number">2</span>)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Usage : %s &lt;port&gt;\n&quot;</span>, argv[<span class="number">0</span>]);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    act.sa_handler=urg_handler;</span><br><span class="line">    sigemptyset(&amp;act.sa_mask);</span><br><span class="line">    act.sa_flags=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    acpt_sock= socket(PF_INET,SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">memset</span>(&amp;recv_adr, <span class="number">0</span>, <span class="keyword">sizeof</span>(recv_adr));</span><br><span class="line">    recv_adr.sin_family=AF_INET;</span><br><span class="line">    recv_adr.sin_addr.s_addr=htonl(INADDR_ANY);</span><br><span class="line">    recv_adr.sin_port=htons(atoi(argv[<span class="number">1</span>]));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(bind(acpt_sock,(<span class="keyword">struct</span> sockaddr*) &amp;recv_adr, <span class="keyword">sizeof</span>(recv_adr))==<span class="number">-1</span>)</span><br><span class="line">        error_handling(<span class="string">&quot;bind()error&quot;</span>);</span><br><span class="line">    listen(acpt_sock, <span class="number">5</span>);</span><br><span class="line">    serv_adr_sz=<span class="keyword">sizeof</span>(serv_adr);</span><br><span class="line">    recv_sock=accept(acpt_sock,(<span class="keyword">struct</span> sockaddr*)&amp;serv_adr, &amp;serv_adr_sz);</span><br><span class="line">    fcntl(recv_sock, F_SETOWN, getpid());</span><br><span class="line">                                <span class="comment">/*将当前进程的PID设置为接收带外数据的进程。带外数据是在TCP协议中的一种特殊的数据传输方式，通常用于传输紧急数据或控制信息。</span></span><br><span class="line"><span class="comment">                                    当远程主机发送带外数据时，会触发套接字上的 SIGURG 信号，这样你的程序可以捕获并处理带外数据。*/</span></span><br><span class="line">    state=sigaction(SIGURG, &amp;act, <span class="number">0</span>);</span><br><span class="line">                                <span class="comment">/*设置信号处理方式SIGURG 信号是一种特殊的信号</span></span><br><span class="line"><span class="comment">                                通常与带外数据（Out-of-Band Data）相关。当一个套接字上接收到带外数据时，会触发 SIGURG 信号。*/</span></span><br><span class="line">    <span class="keyword">while</span>((str_len=recv(recv_sock, buf, <span class="keyword">sizeof</span>(buf), <span class="number">0</span>))!=<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(str_len==<span class="number">-1</span>)</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        buf[str_len]=<span class="number">0</span>;</span><br><span class="line">        <span class="built_in">puts</span>(buf);</span><br><span class="line">    &#125;</span><br><span class="line">    close(recv_sock);</span><br><span class="line">    close(acpt_sock);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">error_handling</span><span class="params">(<span class="type">char</span> *message)</span>&#123;</span><br><span class="line">    <span class="built_in">fputs</span>(message, <span class="built_in">stderr</span>);</span><br><span class="line">    fputc(<span class="string">&#x27;\n&#x27;</span>,<span class="built_in">stderr</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">urg_handler</span><span class="params">(<span class="type">int</span> signo)</span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Received SIGURG signal.\n&quot;</span>);</span><br><span class="line">    <span class="type">int</span> str_len;</span><br><span class="line">    <span class="type">char</span> buf[BUF_SIZE];</span><br><span class="line">    str_len=recv(recv_sock, buf, <span class="keyword">sizeof</span>(buf)<span class="number">-1</span>, MSG_OOB);</span><br><span class="line">    buf[str_len]=<span class="number">0</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Urgent massage  :%s \n&quot;</span>, buf);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BUF_SIZE 30</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">error_handling</span><span class="params">(<span class="type">char</span> *message)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span>&#123;</span><br><span class="line">    <span class="type">int</span> sock;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">recv_adr</span>;</span></span><br><span class="line">    <span class="keyword">if</span>(argc!=<span class="number">3</span>)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Usage : %s &lt;IP&gt; &lt;port&gt;\n&quot;</span>, argv[<span class="number">0</span>]);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   sock = socket(PF_INET,SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">memset</span>(&amp;recv_adr, <span class="number">0</span>, <span class="keyword">sizeof</span>(recv_adr));</span><br><span class="line">    recv_adr.sin_family=AF_INET;</span><br><span class="line">    recv_adr.sin_addr.s_addr=inet_addr(argv[<span class="number">1</span>]);</span><br><span class="line">    recv_adr.sin_port=htons(atoi(argv[<span class="number">2</span>]));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(connect(sock,(<span class="keyword">struct</span> sockaddr*) &amp;recv_adr, <span class="keyword">sizeof</span>(recv_adr))==<span class="number">-1</span>)</span><br><span class="line">        error_handling(<span class="string">&quot;connect()error&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// write(sock, &quot;123&quot;, strlen(&quot;123&quot;));</span></span><br><span class="line">    <span class="comment">// send(sock,&quot;4&quot;,strlen(&quot;4&quot;),MSG_OOB);</span></span><br><span class="line">    <span class="comment">// write(sock,&quot;567&quot;,strlen(&quot;567&quot;));</span></span><br><span class="line">    <span class="comment">// send(sock,&quot;890&quot;,strlen(&quot;890&quot;),MSG_OOB);</span></span><br><span class="line">    write(sock, <span class="string">&quot;123&quot;</span>, <span class="built_in">strlen</span>(<span class="string">&quot;123&quot;</span>));</span><br><span class="line">    sleep(<span class="number">5</span>);</span><br><span class="line">    send(sock, <span class="string">&quot;4&quot;</span>, <span class="built_in">strlen</span>(<span class="string">&quot;4&quot;</span>), MSG_OOB);</span><br><span class="line">    sleep(<span class="number">5</span>);</span><br><span class="line">    send(sock, <span class="string">&quot;890&quot;</span>, <span class="built_in">strlen</span>(<span class="string">&quot;890&quot;</span>), MSG_OOB);</span><br><span class="line">    write(sock, <span class="string">&quot;567&quot;</span>, <span class="built_in">strlen</span>(<span class="string">&quot;567&quot;</span>));</span><br><span class="line">    close(sock);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">error_handling</span><span class="params">(<span class="type">char</span> *message)</span>&#123;</span><br><span class="line">    <span class="built_in">fputs</span>(message, <span class="built_in">stderr</span>);</span><br><span class="line">    fputc(<span class="string">&#x27;\n&#x27;</span>,<span class="built_in">stderr</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">&#125; </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701939480938.png" alt="1701939480938" style="zoom: 67%;">

<h4 id="fcntl（）："><a href="#fcntl（）：" class="headerlink" title="fcntl（）："></a>fcntl（）：</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fcntl(recv_sock, F_SETOWN, getpid())</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701939253581.png" alt="1701939253581" style="zoom:80%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701939357312.png" alt="1701939357312" style="zoom: 67%;">

<h4 id="紧急模式工作原理"><a href="#紧急模式工作原理" class="headerlink" title="紧急模式工作原理"></a>紧急模式工作原理</h4><img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701939804486.png" alt="1701939804486" style="zoom:67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701939868861.png" alt="1701939868861" style="zoom:67%;">

<h4 id="检查输入缓冲-send-recv可选项"><a href="#检查输入缓冲-send-recv可选项" class="headerlink" title="检查输入缓冲 send&amp;recv可选项"></a>检查输入缓冲 send&amp;recv可选项</h4><img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1701933938278.png" alt="1701933938278" style="zoom:67%;">



<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702026443686.png" alt="1702026443686" style="zoom: 80%;">



<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702026421605.png" alt="1702026421605" style="zoom: 80%;">

<h4 id="readv-write函数"><a href="#readv-write函数" class="headerlink" title="readv&amp;write函数"></a>readv&amp;write函数</h4><img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702026551398.png" alt="1702026551398" style="zoom:67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702026564446.png" alt="1702026564446" style="zoom:67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702026613554.png" alt="1702026613554" style="zoom: 67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702026663542.png" alt="1702026663542" style="zoom:67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702028193349.png" alt="1702028193349" style="zoom:67%;">

<h1 id="十四：多播与广播"><a href="#十四：多播与广播" class="headerlink" title="十四：多播与广播"></a>十四：多播与广播</h1><img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702028687901.png" alt="1702028687901" style="zoom: 67%;">

<p>大多数路由器不支持多播，即时支持也因为网络拥堵问题故意阻断多播，在不支持多播的路由器中使用隧道技术Tunneling</p>
<h4 id="设置TTl"><a href="#设置TTl" class="headerlink" title="设置TTl"></a>设置TTl</h4><img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702029075573.png" alt="1702029075573" style="zoom:67%;">

<h4 id="加入多播组"><a href="#加入多播组" class="headerlink" title="加入多播组"></a>加入多播组</h4><img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702029087132.png" alt="1702029087132" style="zoom:67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702029147227.png" alt="1702029147227" style="zoom: 50%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702031425786.png" alt="1702031425786" style="zoom: 67%;">

<h4 id="广播"><a href="#广播" class="headerlink" title="广播"></a>广播</h4><img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702031468403.png" alt="1702031468403" style="zoom:67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702031610381.png" alt="1702031610381" style="zoom:67%;">

<h1 id="linux"><a href="#linux" class="headerlink" title="linux"></a>linux</h1><h1 id="十五：标准IO函数"><a href="#十五：标准IO函数" class="headerlink" title="十五：标准IO函数"></a>十五：标准IO函数</h1><p>优点：</p>
<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702046069934.png" alt="1702046069934" style="zoom: 80%;">

<p>缺点：</p>
<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702046698939.png" alt="1702046698939" style="zoom: 67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702046331323.png" alt="1702046331323" style="zoom:80%;">

<p>系统IO</p>
<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702047342356.png" alt="1702047342356" style="zoom: 67%;">

<p>标准IO</p>
<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702047374043.png" alt="1702047374043" style="zoom:67%;">

<p>fdopen：</p>
<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702047406046.png" alt="1702047406046" style="zoom:67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702047656940.png" alt="1702047656940" style="zoom:67%;">

<p>fileno：（与fdopen相反）</p>
<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702047443572.png" alt="1702047443572" style="zoom:67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702047484310.png" alt="1702047484310" style="zoom:67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702047506180.png" alt="1702047506180" style="zoom:67%;">

<p>fflush：</p>
<p><img src="/.io//hexo\blog\source\source\images\网络编程tcpip\1702047575745.png" alt="1702047575745"></p>
<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702047594642.png" alt="1702047594642" style="zoom:67%;">

<h1 id="十六：IO流分离"><a href="#十六：IO流分离" class="headerlink" title="十六：IO流分离"></a>十六：IO流分离</h1><img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702047761427.png" alt="1702047761427" style="zoom:67%;">

<h4 id="全关闭"><a href="#全关闭" class="headerlink" title="全关闭"></a>全关闭</h4><img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702049667460.png" alt="1702049667460" style="zoom:67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702049695086.png" alt="1702049695086" style="zoom:50%;">

<p><img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702049723280.png" alt="1702049723280" style="zoom: 50%;"><img src="/.io//hexo\blog\source\source\images\网络编程tcpip\1702049743915.png" alt="1702049743915"></p>
<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702049753024.png" alt="1702049753024" style="zoom:50%;">

<h4 id="半关闭shutdown"><a href="#半关闭shutdown" class="headerlink" title="半关闭shutdown"></a>半关闭shutdown</h4><img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702049803021.png" alt="1702049803021" style="zoom:50%;">

<h4 id="dup"><a href="#dup" class="headerlink" title="dup"></a>dup</h4><img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702049828571.png" alt="1702049828571" style="zoom:67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702049896181.png" alt="1702049896181" style="zoom:67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702049982823.png" alt="1702049982823" style="zoom:67%;">

<p> fputs(buf, stdout) ： 将字符串 <code>buf</code> 的内容输出到控制台上，显示给用户看 </p>
<h1 id="十七：优于select的epoll"><a href="#十七：优于select的epoll" class="headerlink" title="十七：优于select的epoll"></a>十七：优于select的epoll</h1><img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702050544398.png" alt="1702050544398" style="zoom: 80%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702050569081.png" alt="1702050569081" style="zoom:80%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702207691576.png" alt="1702207691576" style="zoom: 67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702207717023.png" alt="1702207717023" style="zoom:67%;">

<h4 id="epoll-create"><a href="#epoll-create" class="headerlink" title="epoll_create():"></a>epoll_create():</h4><p>返回创建的epoll例程文件描述符， 用于管理和监视多个文件描述符上的事件 </p>
<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702207832923.png" alt="1702207832923" style="zoom:67%;">

<h4 id="epoll-ctl"><a href="#epoll-ctl" class="headerlink" title="epoll_ctl()"></a>epoll_ctl()</h4><img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702207876766.png" alt="1702207876766" style="zoom: 67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702207898745.png" alt="1702207898745" style="zoom:67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702207973888.png" alt="1702207973888" style="zoom:67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702208033093.png" alt="1702208033093" style="zoom:67%;">

<h4 id="epoll-wait"><a href="#epoll-wait" class="headerlink" title="epoll_wait()"></a>epoll_wait()</h4><img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702208063924.png" alt="1702208063924" style="zoom:67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702208140507.png" alt="1702208140507" style="zoom:67%;">

<h4 id="条件触发-边缘触发"><a href="#条件触发-边缘触发" class="headerlink" title="条件触发&amp;边缘触发"></a>条件触发&amp;边缘触发</h4><img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702210249176.png" alt="1702210249176" style="zoom:67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702210491042.png" alt="1702210491042" style="zoom:67%;">

<h1 id="十八：线程"><a href="#十八：线程" class="headerlink" title="十八：线程"></a>十八：线程</h1><img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702211343245.png" alt="1702211343245" style="zoom: 80%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702211368911.png" alt="1702211368911" style="zoom: 67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702211392992.png" alt="1702211392992" style="zoom:67%;">

<h4 id="pthread-create"><a href="#pthread-create" class="headerlink" title="pthread_create()"></a>pthread_create()</h4><img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702211532492.png" alt="1702211532492" style="zoom:67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702212290888.png" alt="1702212290888" style="zoom:67%;">

<p> 使用一次pthread_create表示创建一个线程，pthread_create第三个参数传递变量地址值给thread_main函数中</p>
<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702212488170.png" alt="1702212488170">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702212505438.png" alt="1702212505438" style="zoom:67%;">

<h4 id="pthread-join-：-主要用途是等待一个指定的线程终止，并获取该线程的返回值"><a href="#pthread-join-：-主要用途是等待一个指定的线程终止，并获取该线程的返回值" class="headerlink" title="pthread_join()： 主要用途是等待一个指定的线程终止，并获取该线程的返回值"></a>pthread_join()： 主要用途是等待一个指定的线程终止，并获取该线程的返回值</h4><img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702212624403.png" alt="1702212624403" style="zoom:67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702213041272.png" alt="1702213041272" style="zoom:67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702213053520.png" alt="1702213053520" style="zoom:67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702213074264.png" alt="1702213074264" style="zoom: 67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702213087127.png" alt="1702213087127" style="zoom:67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702215040096.png" alt="1702215040096" style="zoom:67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702215073901.png" alt="1702215073901">

<p><img src="/.io//hexo\blog\source\source\images\网络编程tcpip\1702215108664.png" alt="1702215108664"></p>
<h4 id="多线程"><a href="#多线程" class="headerlink" title="多线程"></a>多线程</h4><img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702215331698.png" alt="1702215331698" style="zoom:67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702215361475.png" alt="1702215361475" style="zoom: 67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702215377299.png" alt="1702215377299" style="zoom: 67%;">

<p>多线程访问全局变量不安全</p>
<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702215857516.png" alt="1702215857516" style="zoom:67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702215912887.png" alt="1702215912887" style="zoom:67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702215971718.png" alt="1702215971718" style="zoom:67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702216034836.png" alt="1702216034836" style="zoom:67%;">

<h4 id="线程同步"><a href="#线程同步" class="headerlink" title="线程同步"></a>线程同步</h4><p>互斥量：</p>
<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702283707616.png" alt="1702283707616" style="zoom:67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702283725190.png" alt="1702283725190" style="zoom: 80%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702283832369.png" alt="1702283832369" style="zoom: 67%;">

<p><img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702284416114.png" alt="1702284416114" style="zoom:67%;"><img src="/.io//hexo\blog\source\source\images\网络编程tcpip\1702284432233.png" alt="1702284432233"></p>
<p><img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702284432233.png" alt="1702284432233"></p>
<p>（二进制）信号量：</p>
<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702284455480.png" alt="1702284455480" style="zoom:67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702284578750.png" alt="1702284578750" style="zoom:67%;">

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;semaphore.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> *<span class="title function_">read_function</span><span class="params">(<span class="type">void</span> *arg)</span>;</span><br><span class="line"><span class="type">void</span> *<span class="title function_">accu_function</span><span class="params">(<span class="type">void</span> *arg)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">sem_t</span> sem_one;</span><br><span class="line"><span class="type">static</span> <span class="type">sem_t</span> sem_two;</span><br><span class="line"><span class="type">static</span> <span class="type">int</span> num;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span> &#123;</span><br><span class="line">    <span class="type">pthread_t</span> id_t1, id_t2;</span><br><span class="line">    sem_init(&amp;sem_one, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    sem_init(&amp;sem_two, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    pthread_create(&amp;id_t1, <span class="literal">NULL</span>, read_function, <span class="literal">NULL</span>);</span><br><span class="line">    pthread_create(&amp;id_t2, <span class="literal">NULL</span>, accu_function, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    pthread_join(id_t1, <span class="literal">NULL</span>);</span><br><span class="line">    pthread_join(id_t2, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    sem_destroy(&amp;sem_one);</span><br><span class="line">    sem_destroy(&amp;sem_two);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> *<span class="title function_">read_function</span><span class="params">(<span class="type">void</span> *arg)</span> &#123;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">        <span class="built_in">fputs</span>(<span class="string">&quot;Input num : &quot;</span>, <span class="built_in">stdout</span>);</span><br><span class="line">        sem_wait(&amp;sem_two);<span class="comment">//wait-1</span></span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;num);</span><br><span class="line">        sem_post(&amp;sem_one);<span class="comment">//post+1</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> *<span class="title function_">accu_function</span><span class="params">(<span class="type">void</span> *arg)</span> &#123;</span><br><span class="line">    <span class="type">int</span> sum = <span class="number">0</span>, i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">        sem_wait(&amp;sem_one);</span><br><span class="line">        sum += num;</span><br><span class="line">        sem_post(&amp;sem_two);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;result : %d\n&quot;</span>, sum);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sem_wait(&amp;sem);<span class="number">-1</span></span><br><span class="line"><span class="comment">//临界区，sem_wait函数进入临界区的线程在调用sem_post函数前不允许其他线程进入临界区，信号量在0-1之间跳转</span></span><br><span class="line">sem_post(&amp;sem);+<span class="number">1</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//gcc -D_REENTRANT semaphore.c -o semaphore -lpthread</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702287339135.png" alt="1702287339135" style="zoom: 80%;">

<h4 id="线程销毁"><a href="#线程销毁" class="headerlink" title="线程销毁"></a>线程销毁</h4><img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702286520585.png" alt="1702286520585" style="zoom:67%;">

<h4 id="多线程并发服务器和客户端实现："><a href="#多线程并发服务器和客户端实现：" class="headerlink" title="多线程并发服务器和客户端实现："></a>多线程并发服务器和客户端实现：</h4><p>p308</p>
<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702288140327.png" alt="1702288140327" style="zoom:67%;">

<p>客户端：</p>
<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702288048877.png" alt="1702288048877" style="zoom: 67%;">

<p>服务端：</p>
<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702288095168.png" alt="1702288095168" style="zoom:67%;">

<p><img src="/.io//hexo\blog\source\source\images\网络编程tcpip\1702288720178.png" alt="1702288720178"></p>
<p><img src="/.io//hexo\blog\source\source\images\网络编程tcpip\1702288747454.png" alt="1702288747454"></p>
<p><img src="/.io//hexo\blog\source\source\images\网络编程tcpip\1702288802991.png" alt="1702288802991"></p>
<h1 id="二十四：HTTP实现"><a href="#二十四：HTTP实现" class="headerlink" title="二十四：HTTP实现"></a>二十四：HTTP实现</h1><img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702299676804.png" alt="1702299676804" style="zoom:67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702300200792.png" alt="1702300200792" style="zoom:67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702300216915.png" alt="1702300216915" style="zoom: 67%;">

<img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702300242297.png" alt="1702300242297" style="zoom:67%;">

<h4 id="strtok"><a href="#strtok" class="headerlink" title="strtok():"></a>strtok():</h4><img src="/.io//Users\吴柳蓉\Desktop\学习笔记\img\1702300911128.png" alt="1702300911128" style="zoom: 80%;">


















































































































































































































































</div>

<!-- post-guide -->

    <div class="post-guide">
        <div class="item left">
            
        </div>
        <div class="item right">
            
              <a href="/%E5%85%B6%E4%BB%96%E7%AC%94%E8%AE%B0/vscode/">
			  
			
				  <!-- 在这里访问 page.next.slug -->
				  其他笔记/vscode
				
				<i class="fa fa-angle-right" aria-hidden="true"></i>
              </a>
            
        </div>
    </div>


<!-- comment - giscus -->


<!-- comment - valine -->


<script>
	
	
</script>






	</div>
	<div id="footer">
	<p>
	©<span id="footerYear-start"></span>-<span id="footerYear-end"></span>

	
	    <a href="/">lucky</a>
	
	
	
	<br>
	Email:wuliurong2021nnnu@163.com
	</p>
</div>


<script type="text/javascript">
	document.getElementById('footerYear-start').innerHTML = new Date().getFullYear() + '';
</script>

<script type="text/javascript">
	document.getElementById('footerYear-end').innerHTML = new Date().getFullYear() + '';
</script>

	<button id="totop-toggle" class="toggle"><i class="fa fa-angle-double-up" aria-hidden="true"></i></button>
</body>
</html>