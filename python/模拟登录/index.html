<!DOCTYPE html>
<html lang="en">

<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
	
	<!-- title -->
	
	<title>
	
		模拟登录 | 
	 
	hi
	</title>
	
	<!-- keywords,description -->
	
	

	<!-- favicon -->
	
	<link rel="shortcut icon" href="/favicon.ico">
	


	<!-- search -->
	<script>
		var searchEngine = "https://www.google.com/search?q=";
		if(typeof searchEngine == "undefined" || searchEngine == null || searchEngine == ""){
			searchEngine = "https://www.google.com/search?q=";
		}
		var homeHost = "";
		if(typeof homeHost == "undefined" || homeHost == null || homeHost == ""){
			homeHost = window.location.host;
		}
	</script>


	
<link rel="stylesheet" href="/css/main.css">

	
<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css">

	
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/styles/darcula.min.css">

	
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">


	
<script src="https://cdn.jsdelivr.net/npm/jquery@3.7.0/dist/jquery.min.js"></script>

	
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>

	
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/highlight.min.js"></script>

	
<script src="https://cdn.jsdelivr.net/npm/jquery-pjax@2.0.1/jquery.pjax.min.js"></script>

	
<script src="/js/main.js"></script>


	
		
<script src="https://cdn.jsdelivr.net/npm/leancloud-storage/dist/av-min.js"></script>

		
<script src="https://cdn.jsdelivr.net/npm/valine@v1.5.1/dist/Valine.min.js"></script>

	
	

<meta name="generator" content="Hexo 7.0.0"></head>

<body>
	<header id="header">
    <a id="title" href="/" class="logo">hi</a>

	<ul id="menu">
    

    

    

    
      
      
        <li class="menu-item">
          <a href='' class="menu-item-link" target="_blank">
            
          </a>
        </li>
      
    
  
    
      <li class="menu-item">
        <a href='https://github.com/wuliurong' class="menu-item-link" target="_blank">
          <i class="fa fa-github fa-2x"></i>
        </a>
      </li>
    
	</ul>
</header>

	
<div id="sidebar">
	<button id="sidebar-toggle" class="toggle" ><i class="fa fa-arrow-right " aria-hidden="true"></i></button>
	
	<div id="site-toc">
		<input id="search-input" class="search-input" type="search" placeholder="Press Enter to search">
		<div id="tree">
			

			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										Spark
									</a>
									
							<ul>
								<li class="file">
									<a href="/Spark/1-spark%E8%BD%AF%E4%BB%B6%E6%A0%88/">
                     
										    1-spark软件栈
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/Spark/centos%E6%90%AD%E5%BB%BApyspark%E7%8E%AF%E5%A2%83/">
                     
										    centos搭建pyspark环境
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/Spark/rdd%E4%BD%BF%E7%94%A8/">
                     
										    rdd使用
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/Spark/rdd%E7%AC%94%E8%AE%B0/">
                     
										    rdd笔记
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/Spark/scala%E5%9F%BA%E7%A1%80/">
                     
										    scala基础
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/Spark/spark%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">
                     
										    spark学习笔记
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/Spark/spark%E6%BA%90%E7%A0%81%E5%9F%BA%E7%A1%80/">
                     
										    spark源码基础
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/Spark/windows%E6%90%AD%E5%BB%BApyspark%E7%8E%AF%E5%A2%83/">
                     
										    windows搭建pyspark环境
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/Spark/%E4%BD%BF%E7%94%A8IDEA%E5%9C%A8Maven%E4%B8%AD%E5%88%9B%E5%BB%BAjava%E5%92%8Cscala%E9%A1%B9%E7%9B%AE/">
                     
										    使用IDEA在Maven中创建java和scala项目
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/Spark/%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0%E4%B8%8E%E5%AE%9E%E9%AA%8C/">
                     
										    课堂笔记与实验
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										hadoop
									</a>
									
							<ul>
								<li class="file">
									<a href="/hadoop/0.%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE/">
                     
										    0.基本配置
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/hadoop/1.Hadoop%E6%90%AD%E5%BB%BA%E4%BC%AA%E5%88%86%E5%B8%83%E5%BC%8F%E6%A8%A1%E5%BC%8F%E7%8E%AF%E5%A2%83/">
                     
										    1.Hadoop搭建伪分布式模式环境
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/hadoop/10.%E8%BF%90%E8%90%A5%E5%95%86%E5%85%B3%E4%BA%8E%E7%94%A8%E6%88%B7%E5%9F%BA%E7%AB%99%E5%81%9C%E7%95%99%E6%95%B0%E6%8D%AE%E7%BB%9F%E8%AE%A1/">
                     
										    10.运营商关于用户基站停留数据统计
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/hadoop/11.Sqoop%E5%BA%94%E7%94%A8/">
                     
										    11.Sqoop应用
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/hadoop/2.%E9%80%9A%E8%BF%87shell%E5%91%BD%E4%BB%A4%E8%AE%BF%E9%97%AEHDFS/">
                     
										    2.通过shell命令访问HDFS
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/hadoop/3.%E9%80%9A%E8%BF%87API%E8%AE%BF%E9%97%AEHDFS/">
                     
										    3.通过API访问HDFS
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/hadoop/4.%E5%88%86%E6%9E%90%E7%BC%96%E5%86%99WordCount%E7%A8%8B%E5%BA%8F/">
                     
										    4.分析编写WordCount程序
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/hadoop/5.Mapreduce%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%88%86%E5%8C%BA/">
                     
										    5.Mapreduce序列化和分区
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/hadoop/6.MapReduce%E5%AE%9E%E9%AA%8Csales/">
                     
										    6.MapReduce实验sales
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/hadoop/7.hive%E5%AE%9E%E9%AA%8C/">
                     
										    7.hive实验
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/hadoop/8.%E6%90%9C%E7%8B%97%E6%97%A5%E5%BF%97%E6%9F%A5%E8%AF%A2%E5%88%86%E6%9E%90MapReduce+hive/">
                     
										    8.搜狗日志查询分析MapReduce+hive
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/hadoop/9.%E5%9F%BA%E4%BA%8EHBase%E7%9A%84MapReduce%E8%AE%A1%E7%AE%97/">
                     
										    9.基于HBase的MapReduce计算
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/hadoop/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">
                     
										    学习笔记
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/hadoop/%E5%AE%9E%E9%AA%8C-%E5%9F%BA%E4%BA%8Ehadoop%E4%BA%92%E8%81%94%E7%BD%91%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98/">
                     
										    实验-基于hadoop互联网日志分析实战
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/hadoop/%E5%AE%9E%E9%AA%8C%E8%AE%B0%E5%BD%95/">
                     
										    实验记录
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										java
									</a>
									
							<ul>
								<li class="file">
									<a href="/java/linux/">
                     
										    linux
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										linux
									</a>
									
							<ul>
								<li class="file">
									<a href="/linux/%E5%9F%BA%E7%A1%80/">
                     
										    基础
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										python
									</a>
									
							<ul>
								<li class="file">
									<a href="/python/1-%E5%9F%BA%E7%A1%80/">
                     
										    1-基础
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/python/2-%E7%AC%94%E8%AE%B0/">
                     
										    2-笔记
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/python/3-%E6%8A%A5%E9%94%99/">
                     
										    3-报错
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/python/4.%E5%AE%9E%E8%B7%B5/">
                     
										    4.实践
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/python/lambda/">
                     
										    lambda
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/python/python/">
                     
										    python
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/python/%E4%BD%9C%E4%B8%9A-pyechart/">
                     
										    作业-pyechart
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/python/%E4%BD%9C%E4%B8%9A-%E5%BD%93%E5%BD%93%E7%BD%91%E8%AE%A1%E7%AE%97%E6%9C%BA%E4%B9%A6%E7%B1%8D%E6%95%B0%E6%8D%AE%E6%8C%96%E6%8E%98%E4%B8%8E%E5%8F%AF%E8%A7%86%E5%8C%96%E5%88%86%E6%9E%90/">
                     
										    作业-当当网计算机书籍数据挖掘与可视化分析
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file active">
									<a href="/python/%E6%A8%A1%E6%8B%9F%E7%99%BB%E5%BD%95/">
                     
										    模拟登录
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/python/%E7%88%AC%E5%8F%96%E5%8A%A8%E6%80%81%E9%A1%B5%E9%9D%A2/">
                     
										    爬取动态页面
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										tableau
									</a>
									
							<ul>
								<li class="file">
									<a href="/tableau/%E4%BD%9C%E4%B8%9A-tableau/">
                     
										    作业-tableau
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/tableau/%E8%AF%BE%E4%BB%B6-tableau%E4%BB%AA%E8%A1%A8%E6%9D%BF/">
                     
										    课件-tableau仪表板
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/tableau/%E8%AF%BE%E4%BB%B6-tableau%E5%85%A5%E9%97%A8/">
                     
										    课件-tableau入门
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/tableau/%E8%AF%BE%E4%BB%B6-tableau%E7%BB%83%E4%B9%A0/">
                     
										    课件-tableau练习
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										其他笔记
									</a>
									
							<ul>
								<li class="file">
									<a href="/%E5%85%B6%E4%BB%96%E7%AC%94%E8%AE%B0/docker/">
                     
										    docker
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/%E5%85%B6%E4%BB%96%E7%AC%94%E8%AE%B0/vscode/">
                     
										    vscode
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/%E5%85%B6%E4%BB%96%E7%AC%94%E8%AE%B0/%E5%9F%BA%E7%A1%80/">
                     
										    基础
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/%E5%85%B6%E4%BB%96%E7%AC%94%E8%AE%B0/%E9%95%9C%E5%83%8F%E6%BA%90/">
                     
										    镜像源
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="file">
									<a href="/%E5%9C%A8%E6%A0%A1%E7%BB%8F%E5%8E%86/">
                     
										    在校经历
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										报错
									</a>
									
							<ul>
								<li class="file">
									<a href="/%E6%8A%A5%E9%94%99/Hyper-V/">
                     
										    Hyper-V
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/%E6%8A%A5%E9%94%99/github%E5%9F%BA%E7%A1%80%E8%AF%AD%E5%8F%A5/">
                     
										    github基础语句
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/%E6%8A%A5%E9%94%99/hexo-deploy/">
                     
										    hexo-deploy
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/%E6%8A%A5%E9%94%99/hexo-typora-img/">
                     
										    hexo-typora-img
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/%E6%8A%A5%E9%94%99/linux%E8%BF%9E%E4%B8%8D%E4%B8%8A%E7%BD%91/">
                     
										    linux连不上网
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/%E6%8A%A5%E9%94%99/vscode-install-config/">
                     
										    vscode-install-config
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										数仓学习
									</a>
									
							<ul>
								<li class="file">
									<a href="/%E6%95%B0%E4%BB%93%E5%AD%A6%E4%B9%A0/%E7%A6%BB%E7%BA%BF%E5%AE%9E%E6%97%B6%E6%95%B0%E4%BB%93%E6%A6%82%E8%AE%BA/">
                     
										    离线实时数仓概论
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										日记
									</a>
									
							<ul>
								<li class="file">
									<a href="/%E6%97%A5%E8%AE%B0/2022-12-24/">
                     
										    2022-12-24
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/%E6%97%A5%E8%AE%B0/2024-1-13/">
                     
										    2024-1-13
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/%E6%97%A5%E8%AE%B0/2024-1-17/">
                     
										    2024-1-17
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/%E6%97%A5%E8%AE%B0/2024-1-19/">
                     
										    2024-1-19
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/%E6%97%A5%E8%AE%B0/2024-2-15/">
                     
										    2024-2-15
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										科研经历
									</a>
									
							<ul>
								<li class="file">
									<a href="/%E7%A7%91%E7%A0%94%E7%BB%8F%E5%8E%86/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E5%9B%BE%E5%83%8F%E5%88%86%E7%B1%BB%E4%B8%AD%E7%9A%84%E5%AF%B9%E6%8A%97%E6%A0%B7%E6%9C%AC%E9%97%AE%E9%A2%98/">
                     
										    深度学习图像分类中的对抗样本问题
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
		</div>
	</div>
</div>

	<!-- 引入正文 -->
	<div id="content" class="content">
		<h1 id="article-title">
	模拟登录
</h1>

<!-- meta -->
<div class="article-meta">
	

	<span>lucky</span>
	<span>2024-06-11 18:51:56</span>

  <div id="article-categories">
    
		  <span>Categories：</span>
      
    

    
		    <span>Tags：</span>
        
    
  </div>

</div>

<!-- content -->
<div id="article-content">
	<h1 id="FormRequest"><a href="#FormRequest" class="headerlink" title="FormRequest"></a>FormRequest</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line">     <span class="keyword">import</span> scrapy</span><br><span class="line">     <span class="keyword">from</span> scrapy.http <span class="keyword">import</span> Request, FormRequest</span><br><span class="line">     <span class="keyword">class</span> <span class="title class_">LoginSpider</span>(scrapy.Spider):</span><br><span class="line">        name = <span class="string">&quot;login&quot;</span></span><br><span class="line">        allowed_domains = [<span class="string">&quot;example.webscraping.com&quot;</span>]</span><br><span class="line">        start_urls = [<span class="string">&#x27;http://example.webscraping.com/user/profile&#x27;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">parse</span>(<span class="params">self, response</span>):</span><br><span class="line">            <span class="comment"># 解析登录后下载的页面，此例中为用户个人信息页面</span></span><br><span class="line">            keys = response.css(<span class="string">&#x27;table label::text&#x27;</span>).re(<span class="string">&#x27;(.+):&#x27;</span>)</span><br><span class="line">            values = response.css(<span class="string">&#x27;table td.w2p_fw::text&#x27;</span>).extract()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="keyword">yield</span> <span class="built_in">dict</span>(<span class="built_in">zip</span>(keys, values))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment"># ----------------------------登录---------------------------------</span></span><br><span class="line">        <span class="comment"># 登录页面的url</span></span><br><span class="line">        login_url = <span class="string">&#x27;http://example.webscraping.com/user/login&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">start_requests</span>(<span class="params">self</span>):</span><br><span class="line">            <span class="keyword">yield</span> Request(self.login_url, callback=self.login)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">self, response</span>):</span><br><span class="line">            <span class="comment"># 登录页面的解析函数，构造FormRequest对象提交表单</span></span><br><span class="line">            fd = &#123;<span class="string">&#x27;email&#x27;</span>: <span class="string">&#x27;liushuo@webscraping.com&#x27;</span>, <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;12345678&#x27;</span>&#125;</span><br><span class="line">            <span class="keyword">yield</span> FormRequest.from_response(response, formdata=fd,</span><br><span class="line">                                         callback=self.parse_login)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">parse_login</span>(<span class="params">self, response</span>):</span><br><span class="line">            <span class="comment"># 登录成功后，继续爬取start_urls 中的页面</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;Welcome Liu&#x27;</span> <span class="keyword">in</span> response.text:</span><br><span class="line">                <span class="keyword">yield</span> <span class="keyword">from</span> <span class="built_in">super</span>().start_requests() <span class="comment"># Python 3语法</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>解释上述代码如下：<br>●　覆写基类的start_requests方法，最先请求登录页面。<br>●　login方法为登录页面的解析函数，在该方法中进行模拟登录，构造表单请求并提交。<br>●　parse_login方法为表单请求的响应处理函数，在该方法中通过在页面查找特殊字符串’Welcome Liu’判断是否登录成功，如果成功，调用基类的start_requests方法，继续爬取start_urls中的页面。</p>
<h1 id="识别验证码"><a href="#识别验证码" class="headerlink" title="识别验证码"></a>识别验证码</h1><h2 id="OCR识别"><a href="#OCR识别" class="headerlink" title="OCR识别"></a>OCR识别</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line">     <span class="keyword">import</span> scrapy</span><br><span class="line">     <span class="keyword">from</span> scrapy <span class="keyword">import</span> Request, FormRequest</span><br><span class="line">     <span class="keyword">import</span> json</span><br><span class="line">     <span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line">     <span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line">     <span class="keyword">import</span> pytesseract</span><br><span class="line">     <span class="keyword">from</span> scrapy.log <span class="keyword">import</span> logger</span><br><span class="line"></span><br><span class="line">     <span class="keyword">class</span> <span class="title class_">CaptchaLoginSpider</span>(scrapy.Spider):</span><br><span class="line">     name = <span class="string">&quot;login_captcha&quot;</span></span><br><span class="line">     start_urls = [<span class="string">&#x27;http://XXX.com/&#x27;</span>]</span><br><span class="line"></span><br><span class="line">     <span class="keyword">def</span> <span class="title function_">parse</span>(<span class="params">self, response</span>):</span><br><span class="line">        ...</span><br><span class="line">     <span class="comment"># X 网站登录页面的url（虚构的）</span></span><br><span class="line">     login_url = <span class="string">&#x27;http://XXX.com/login&#x27;</span></span><br><span class="line">     user      = <span class="string">&#x27;liushuo@XXX.com&#x27;</span></span><br><span class="line">     password  = <span class="string">&#x27;12345678&#x27;</span></span><br><span class="line"></span><br><span class="line">     <span class="keyword">def</span> <span class="title function_">start_requests</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">yield</span> Request(self.login_url, callback=self.login, dont_filter=<span class="literal">True</span>)</span><br><span class="line">     <span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">self, response</span>):</span><br><span class="line">        <span class="comment"># 该方法既是登录页面的解析函数，又是下载验证码图片的响应处理函数</span></span><br><span class="line">        <span class="comment"># 如果response.meta[&#x27;login_response&#x27;]存在，当前response 为验证码图片的响应</span></span><br><span class="line">        <span class="comment"># 否则当前response 为登录页面的响应</span></span><br><span class="line">        login_response = response.meta.get(<span class="string">&#x27;login_response&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> login_response:</span><br><span class="line">            <span class="comment"># Step 1:</span></span><br><span class="line">            <span class="comment"># 此时response 为登录页面的响应，从中提取验证码图片的url，下载验证码图片</span></span><br><span class="line">            captchaUrl = response.css(<span class="string">&#x27;label.field.prepend-icon img::attr(src)&#x27;</span>)\</span><br><span class="line">                              .extract_first()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            captchaUrl = response.urljoin(captchaUrl)</span><br><span class="line">            <span class="comment"># 构造Request 时，将当前response 保存到meta 字典中</span></span><br><span class="line">            <span class="keyword">yield</span> Request(captchaUrl,</span><br><span class="line">                       callback=self.login,</span><br><span class="line">                       meta=&#123;<span class="string">&#x27;login_response&#x27;</span>: response&#125;,</span><br><span class="line">                       dont_filter=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># Step 2:</span></span><br><span class="line">            <span class="comment"># 此时，response 为验证码图片的响应，response.body是图片二进制数据</span></span><br><span class="line">            <span class="comment"># l</span></span><br><span class="line">            ogin_response 为登录页面的响应，用其构造表单请求并发送</span><br><span class="line">            formdata = &#123;</span><br><span class="line">               <span class="string">&#x27;email&#x27;</span>: self.user,</span><br><span class="line">               <span class="string">&#x27;pass&#x27;</span>: self.password,</span><br><span class="line">               <span class="comment"># 使用OCR识别</span></span><br><span class="line">               <span class="string">&#x27;code&#x27;</span>: self.get_captcha_by_OCR(response.body),</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">yield</span> FormRequest.from_response(login_response,</span><br><span class="line">                                            callback=self.parse_login,</span><br><span class="line"> </span><br><span class="line">                                            formdata=formdata, dont_filter=<span class="literal">True</span>)</span><br><span class="line">     <span class="keyword">def</span> <span class="title function_">parse_login</span>(<span class="params">self, response</span>):</span><br><span class="line">        <span class="comment"># 根据响应结果判断是否登录成功</span></span><br><span class="line">        info = json.loads(response.text)</span><br><span class="line">        <span class="keyword">if</span> info[<span class="string">&#x27;error&#x27;</span>] == <span class="string">&#x27;0&#x27;</span>:</span><br><span class="line">            logger.info(<span class="string">&#x27;登录成功:-)&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">super</span>().start_requests()</span><br><span class="line">        logger.info(<span class="string">&#x27;登录失败:-(, 重新登录...&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> self.start_requests()</span><br><span class="line">     <span class="keyword">def</span> <span class="title function_">get_captcha_by_OCR</span>(<span class="params">self, data</span>):</span><br><span class="line">        <span class="comment"># OCR识别</span></span><br><span class="line">        img = Image.<span class="built_in">open</span>(BytesIO(data))</span><br><span class="line">        img = img.convert(<span class="string">&#x27;L&#x27;</span>)</span><br><span class="line">        captcha = pytesseract.image_to_string(img)</span><br><span class="line">        img.close()</span><br><span class="line">        <span class="keyword">return</span> captcha</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="网络平台识别"><a href="#网络平台识别" class="headerlink" title="网络平台识别"></a>网络平台识别</h2><p><img src="/../../source/images/%E6%A8%A1%E6%8B%9F%E7%99%BB%E5%BD%95/1718103403282.png" alt="1718103403282"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> pprint <span class="keyword">import</span> pprint</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 购买服务后，平台发放给我们一个appcode，用来识别请求者的身份</span></span><br><span class="line">APPCODE = <span class="string">&#x27;f239ccawf37f287418a90e2f922649273c4&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://ali-checkcode.showapi.com/checkcode&#x27;</span></span><br><span class="line">img_data = <span class="built_in">open</span>(<span class="string">&#x27;code.gif&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line">form = &#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 不转换为jpg</span></span><br><span class="line">form[<span class="string">&#x27;convert_to_jpg&#x27;</span>] = <span class="string">&#x27;0&#x27;</span></span><br><span class="line"><span class="comment"># 对图片进行base64 编码</span></span><br><span class="line">form[<span class="string">&#x27;img_base64&#x27;</span>] = base64.b64encode(img_data)</span><br><span class="line"><span class="comment"># 7 位汉字</span></span><br><span class="line">form[<span class="string">&#x27;typeId&#x27;</span>] = <span class="string">&#x27;4070&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用户验证</span></span><br><span class="line">headers = &#123;<span class="string">&#x27;Authorization&#x27;</span>: <span class="string">&#x27;APPCODE &#x27;</span> + APPCODE&#125;</span><br><span class="line">response = requests.post(url, headers=headers, data=form)</span><br><span class="line">pprint(response.json())</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>把使用平台识别验证码的方式也加入CaptchaLoginSpider中，只需添加一个get_captcha_by_network方法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CaptchaLoginSpider</span>(scrapy.Spider):</span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">get_captcha_by_OCR</span>(<span class="params">self, data</span>):</span><br><span class="line">           <span class="comment"># OCR识别</span></span><br><span class="line">           img = Image.<span class="built_in">open</span>(BytesIO(data))</span><br><span class="line">           img = img.convert(<span class="string">&#x27;L&#x27;</span>)</span><br><span class="line">           captcha = pytesseract.image_to_string(img)</span><br><span class="line">           img.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">           <span class="keyword">return</span> captcha</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">get_captcha_by_network</span>(<span class="params">self, data</span>):</span><br><span class="line">           <span class="comment"># 平台识别</span></span><br><span class="line">           <span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">           url = <span class="string">&#x27;http://ali-checkcode.showapi.com/checkcode&#x27;</span></span><br><span class="line">           appcode = <span class="string">&#x27;f23cca37f287418a90e2f922649273c4&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">           form = &#123;&#125;</span><br><span class="line">           form[<span class="string">&#x27;convert_to_jpg&#x27;</span>] = <span class="string">&#x27;0&#x27;</span></span><br><span class="line">           form[<span class="string">&#x27;img_base64&#x27;</span>] = base64.b64encode(data)</span><br><span class="line">           form[<span class="string">&#x27;typeId&#x27;</span>] = <span class="string">&#x27;3040&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">           headers = &#123;<span class="string">&#x27;Authorization&#x27;</span>: <span class="string">&#x27;APPCODE &#x27;</span> + appcode&#125;</span><br><span class="line">           response = requests.post(url, headers=headers, data=form)</span><br><span class="line">           res = response.json()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">           <span class="keyword">if</span> res[<span class="string">&#x27;showapi_res_code&#x27;</span>] == <span class="number">0</span>:</span><br><span class="line">              <span class="keyword">return</span> res[<span class="string">&#x27;showapi_res_body&#x27;</span>][<span class="string">&#x27;Result&#x27;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">           <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="人工识别"><a href="#人工识别" class="headerlink" title="人工识别"></a>人工识别</h2><h2 id="Cookie登录"><a href="#Cookie登录" class="headerlink" title="Cookie登录"></a>Cookie登录</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pip install -i https://pypi.tuna.tsinghua.edu.cn/simple browsercookie</span><br><span class="line">    </span><br><span class="line">pip install -i https://pypi.tuna.tsinghua.edu.cn/simple browser-cookie</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#用法</span><br><span class="line">import browsercookie</span><br><span class="line">chrome_cookiejar = browsercookie.chrome()</span><br><span class="line">firefox_cookiejar = browsercookie.firefox()</span><br><span class="line">type(chrome_cookiejar)</span><br><span class="line">for cookie in chrome_cookiejar:</span><br><span class="line">	print(cookie)</span><br><span class="line"></span><br><span class="line">返回值是一个http.cookiejar.CookieJar对象，对CookieJar对象进行迭代，可以访问其中的每个Cookie对象</span><br></pre></td></tr></table></figure>

<h3 id="CookiesMiddleware源码分析"><a href="#CookiesMiddleware源码分析" class="headerlink" title="CookiesMiddleware源码分析"></a>CookiesMiddleware源码分析</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> six</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"><span class="keyword">from</span> scrapy.exceptions <span class="keyword">import</span> NotConfigured</span><br><span class="line"><span class="keyword">from</span> scrapy.http <span class="keyword">import</span> Response</span><br><span class="line"><span class="keyword">from</span> scrapy.http.cookies <span class="keyword">import</span> CookieJar</span><br><span class="line"><span class="keyword">from</span> scrapy.utils.python <span class="keyword">import</span> to_native_str</span><br><span class="line"></span><br><span class="line">logger = logging.getLogger(__name__)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CookiesMiddleware</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;This middleware enables working with sites that need cookies&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, debug=<span class="literal">False</span></span>):</span><br><span class="line">        self.jars = defaultdict(CookieJar)</span><br><span class="line">        self.debug = debug</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">from_crawler</span>(<span class="params">cls, crawler</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> crawler.settings.getbool(<span class="string">&#x27;COOKIES_ENABLED&#x27;</span>):</span><br><span class="line">            <span class="keyword">raise</span> NotConfigured</span><br><span class="line">        <span class="keyword">return</span> cls(crawler.settings.getbool(<span class="string">&#x27;COOKIES_DEBUG&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_request</span>(<span class="params">self, request, spider</span>):</span><br><span class="line">        <span class="keyword">if</span> request.meta.get(<span class="string">&#x27;dont_merge_cookies&#x27;</span>, <span class="literal">False</span>):</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        cookiejarkey = request.meta.get(<span class="string">&quot;cookiejar&quot;</span>)</span><br><span class="line">        jar = self.jars[cookiejarkey]</span><br><span class="line">        cookies = self._get_request_cookies(jar, request)</span><br><span class="line">        <span class="keyword">for</span> cookie <span class="keyword">in</span> cookies:</span><br><span class="line">            jar.set_cookie_if_ok(cookie, request)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># set Cookie header</span></span><br><span class="line">        request.headers.pop(<span class="string">&#x27;Cookie&#x27;</span>, <span class="literal">None</span>)</span><br><span class="line">        jar.add_cookie_header(request)</span><br><span class="line">        self._debug_cookie(request, spider)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_response</span>(<span class="params">self, request, response, spider</span>):</span><br><span class="line">        <span class="keyword">if</span> request.meta.get(<span class="string">&#x27;dont_merge_cookies&#x27;</span>, <span class="literal">False</span>):</span><br><span class="line">            <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line">        <span class="comment"># extract cookies from Set-Cookie and drop invalid/expired cookies</span></span><br><span class="line">        cookiejarkey = request.meta.get(<span class="string">&quot;cookiejar&quot;</span>)</span><br><span class="line">        jar = self.jars[cookiejarkey]</span><br><span class="line">        jar.extract_cookies(response, request)</span><br><span class="line">        self._debug_set_cookie(response, spider)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_debug_cookie</span>(<span class="params">self, request, spider</span>):</span><br><span class="line">        <span class="keyword">if</span> self.debug:</span><br><span class="line">            cl = [to_native_str(c, errors=<span class="string">&#x27;replace&#x27;</span>)</span><br><span class="line">                  <span class="keyword">for</span> c <span class="keyword">in</span> request.headers.getlist(<span class="string">&#x27;Cookie&#x27;</span>)]</span><br><span class="line">            <span class="keyword">if</span> cl:</span><br><span class="line">                cookies = <span class="string">&quot;\n&quot;</span>.join(<span class="string">&quot;Cookie: &#123;&#125;\n&quot;</span>.<span class="built_in">format</span>(c) <span class="keyword">for</span> c <span class="keyword">in</span> cl)</span><br><span class="line">                msg = <span class="string">&quot;Sending cookies to: &#123;&#125;\n&#123;&#125;&quot;</span>.<span class="built_in">format</span>(request, cookies)</span><br><span class="line">                logger.debug(msg, extra=&#123;<span class="string">&#x27;spider&#x27;</span>: spider&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_debug_set_cookie</span>(<span class="params">self, response, spider</span>):</span><br><span class="line">        <span class="keyword">if</span> self.debug:</span><br><span class="line">            cl = [to_native_str(c, errors=<span class="string">&#x27;replace&#x27;</span>)</span><br><span class="line">                  <span class="keyword">for</span> c <span class="keyword">in</span> response.headers.getlist(<span class="string">&#x27;Set-Cookie&#x27;</span>)]</span><br><span class="line">            <span class="keyword">if</span> cl:</span><br><span class="line">                cookies = <span class="string">&quot;\n&quot;</span>.join(<span class="string">&quot;Set-Cookie: &#123;&#125;\n&quot;</span>.<span class="built_in">format</span>(c) <span class="keyword">for</span> c <span class="keyword">in</span> cl)</span><br><span class="line">                msg = <span class="string">&quot;Received cookies from: &#123;&#125;\n&#123;&#125;&quot;</span>.<span class="built_in">format</span>(response, cookies)</span><br><span class="line">                logger.debug(msg, extra=&#123;<span class="string">&#x27;spider&#x27;</span>: spider&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_format_cookie</span>(<span class="params">self, cookie</span>):</span><br><span class="line">        <span class="comment"># build cookie string</span></span><br><span class="line">        cookie_str = <span class="string">&#x27;%s=%s&#x27;</span> % (cookie[<span class="string">&#x27;name&#x27;</span>], cookie[<span class="string">&#x27;value&#x27;</span>])</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> cookie.get(<span class="string">&#x27;path&#x27;</span>, <span class="literal">None</span>):</span><br><span class="line">            cookie_str += <span class="string">&#x27;; Path=%s&#x27;</span> % cookie[<span class="string">&#x27;path&#x27;</span>]</span><br><span class="line">        <span class="keyword">if</span> cookie.get(<span class="string">&#x27;domain&#x27;</span>, <span class="literal">None</span>):</span><br><span class="line">            cookie_str += <span class="string">&#x27;; Domain=%s&#x27;</span> % cookie[<span class="string">&#x27;domain&#x27;</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> cookie_str</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_get_request_cookies</span>(<span class="params">self, jar, request</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(request.cookies, <span class="built_in">dict</span>):</span><br><span class="line">            cookie_list = [&#123;<span class="string">&#x27;name&#x27;</span>: k, <span class="string">&#x27;value&#x27;</span>: v&#125; <span class="keyword">for</span> k, v <span class="keyword">in</span> six.iteritems(request.cookies)]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            cookie_list = request.cookies</span><br><span class="line"></span><br><span class="line">        cookies = [self._format_cookie(x) <span class="keyword">for</span> x <span class="keyword">in</span> cookie_list]</span><br><span class="line">        headers = &#123;<span class="string">&#x27;Set-Cookie&#x27;</span>: cookies&#125;</span><br><span class="line">        response = Response(request.url, headers=headers)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> jar.make_cookies(response, request)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="实现BrowserCookiesMiddleware"><a href="#实现BrowserCookiesMiddleware" class="headerlink" title="实现BrowserCookiesMiddleware"></a>实现BrowserCookiesMiddleware</h3><p>CookiesMiddleware自动处理Cookie的特性给用户提供了便利，但它不能使用浏览器的Cookie，我们可以利用browsercookie对CookiesMiddleware进行改良，实现一个能使用浏览器Cookie的中间件</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> browsercookie</span><br><span class="line"><span class="keyword">from</span> scrapy.downloadermiddlewares.cookies <span class="keyword">import</span> CookiesMiddleware</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BrowserCookiesMiddleware</span>(<span class="title class_ inherited__">CookiesMiddleware</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, debug=<span class="literal">False</span></span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(debug)</span><br><span class="line">        self.load_browser_cookies()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">load_browser_cookies</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 加载Chrome 浏览器中的Cookie</span></span><br><span class="line">        jar = self.jars[<span class="string">&#x27;chrome&#x27;</span>]</span><br><span class="line">        chrome_cookiejar = browsercookie.chrome()</span><br><span class="line">        <span class="keyword">for</span> cookie <span class="keyword">in</span> chrome_cookiejar:</span><br><span class="line">            jar.set_cookie(cookie)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 加载Firefox 浏览器中的Cookie</span></span><br><span class="line">        jar = self.jars[<span class="string">&#x27;firefox&#x27;</span>]</span><br><span class="line">        firefox_cookiejar = browsercookie.firefox()</span><br><span class="line">        <span class="keyword">for</span> cookie <span class="keyword">in</span> firefox_cookiejar:</span><br><span class="line">            jar.set_cookie(cookie)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="知乎个人信息"><a href="#知乎个人信息" class="headerlink" title="知乎个人信息"></a>知乎个人信息</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">scrapy startproject browser_cookie</span><br><span class="line"></span><br><span class="line">将BrowserCookiesMiddleware源码复制到该项目下的middlewares.py中，并在配置文件settings.py中添加如下配置：</span><br><span class="line"># 伪装成常规浏览器</span><br><span class="line">     USER_AGENT = &#x27;Mozilla/5.0 (X11; Linux x86_64) Chrome/42.0.2311.90 Safari/537.36&#x27;</span><br><span class="line">     # 用BrowserCookiesMiddleware 替代CookiesMiddleware 启用前者，关闭后者</span><br><span class="line">     DOWNLOADER_MIDDLEWARES = &#123;</span><br><span class="line">        &#x27;scrapy.downloadermiddlewares.cookies.CookiesMiddleware&#x27;: None,</span><br><span class="line">        &#x27;browser_cookie.middlewares.BrowserCookiesMiddleware&#x27;: 701,</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">由于需求非常简单，因此不再编写Spider，直接在scrapy shell环境中进行演示。注意，为了使用项目中的配置，需要在项目目录下启动scrapy shell命令：</span><br><span class="line"></span><br><span class="line">     $ scrapy shell</span><br><span class="line">     ...</span><br><span class="line">     &gt;&gt;&gt; from scrapy import Request</span><br><span class="line">     &gt;&gt;&gt; url = &#x27;https://www.zhihu.com/settings/profile&#x27;</span><br><span class="line">     &gt;&gt;&gt; fetch(Request(url, meta=&#123;&#x27;cookiejar&#x27;: &#x27;chrome&#x27;&#125;))</span><br><span class="line">     ...</span><br><span class="line">     &gt;&gt;&gt; view(response)</span><br><span class="line"></span><br><span class="line">调用view函数后，在浏览器中可看到如图10-13所示的页面。</span><br><span class="line">最后，提取页面中的“姓名”和“个性域名”信息：</span><br><span class="line"></span><br><span class="line">     &gt;&gt;&gt; response.css(&#x27;div#rename-section span.name::text&#x27;).extract_first()</span><br><span class="line">     &#x27;硕-奶酪&#x27;</span><br><span class="line">     &gt;&gt;&gt; response.xpath(&#x27;string(//div[@id=&quot;js-url-preview&quot;])&#x27;).extract_first()</span><br><span class="line">     &#x27;zhihu.com/people/shuo_cheese&#x27;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">失败，PermissionError: [Errno 13] Permission denied: &#x27;C:\\Users\\www\\AppData\\Local\\Google\\Chrome\\User Data\\Default\\Network\\Cookies&#x27;</span><br></pre></td></tr></table></figure>















<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure>





<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure>





<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure>





<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure>





<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure>





<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure>





<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure>




</div>

<!-- post-guide -->

    <div class="post-guide">
        <div class="item left">
            
              <a href="/python/%E7%88%AC%E5%8F%96%E5%8A%A8%E6%80%81%E9%A1%B5%E9%9D%A2/">
                  <i class="fa fa-angle-left" aria-hidden="true"></i>
                  爬取动态页面
              </a>
            
        </div>
        <div class="item right">
            
              <a href="/python/4.%E5%AE%9E%E8%B7%B5/">
			  
			
				  <!-- 在这里访问 page.next.slug -->
				  python/4.实践
				
				<i class="fa fa-angle-right" aria-hidden="true"></i>
              </a>
            
        </div>
    </div>


<!-- comment - giscus -->


<!-- comment - valine -->


<script>
	
	
</script>






	</div>
	<div id="footer">
	<p>
	©<span id="footerYear-start"></span>-<span id="footerYear-end"></span>

	
	    <a href="/">lucky</a>
	
	
	
	<br>
	Email:wuliurong2021nnnu@163.com
	</p>
</div>


<script type="text/javascript">
	document.getElementById('footerYear-start').innerHTML = new Date().getFullYear() + '';
</script>

<script type="text/javascript">
	document.getElementById('footerYear-end').innerHTML = new Date().getFullYear() + '';
</script>

	<button id="totop-toggle" class="toggle"><i class="fa fa-angle-double-up" aria-hidden="true"></i></button>
</body>
</html>